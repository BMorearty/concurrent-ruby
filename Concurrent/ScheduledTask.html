<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Concurrent::ScheduledTask
  
    &mdash; Concurrent
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!Concurrent/ScheduledTask.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (S)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span></span>
     &raquo; 
    <span class="title">ScheduledTask</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Concurrent::ScheduledTask
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="IVar.html" title="Concurrent::IVar (class)">IVar</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next"><span class='object_link'><a href="IVar.html" title="Concurrent::IVar (class)">IVar</a></span></li>
          
            <li class="next">Concurrent::ScheduledTask</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/concurrent/scheduled_task.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p><p><code>ScheduledTask</code> is a close relative of <code>Concurrent::Future</code> but with one important difference. A <code>Future</code> is set to execute as soon as possible whereas a <code>ScheduledTask</code> is set to execute at a specific time. This implementation is loosely based on Java&#39;s <a href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ScheduledExecutorService.html">ScheduledExecutorService</a>. </p>

<h3>Example</h3>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>concurrent</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>thread</span><span class='tstring_end'>&#39;</span></span>   <span class='comment'># for Queue
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>open-uri</span><span class='tstring_end'>&#39;</span></span> <span class='comment'># for open(uri)
</span>
<span class='kw'>class</span> <span class='const'>Ticker</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_get_year_end_closing'>get_year_end_closing</span><span class='lparen'>(</span><span class='id identifier rubyid_symbol'>symbol</span><span class='comma'>,</span> <span class='id identifier rubyid_year'>year</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_uri'>uri</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http://ichart.finance.yahoo.com/table.csv?s=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_symbol'>symbol</span><span class='embexpr_end'>}</span><span class='tstring_content'>&amp;a=11&amp;b=01&amp;c=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_year'>year</span><span class='embexpr_end'>}</span><span class='tstring_content'>&amp;d=11&amp;e=31&amp;f=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_year'>year</span><span class='embexpr_end'>}</span><span class='tstring_content'>&amp;g=m</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='id identifier rubyid_uri'>uri</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_line'>line</span><span class='op'>|</span> <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span> <span class='rbrace'>}</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>4</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='comment'># Future
</span><span class='id identifier rubyid_price'>price</span> <span class='op'>=</span> <span class='const'>Concurrent</span><span class='op'>::</span><span class='const'>Future</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lbrace'>{</span> <span class='const'>Ticker</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_get_year_end_closing'>get_year_end_closing</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>TWTR</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='int'>2013</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_price'>price</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span> <span class='comment'>#=&gt; :pending
</span><span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span>    <span class='comment'># do other stuff
</span><span class='id identifier rubyid_price'>price</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='comment'>#=&gt; 63.65
</span><span class='id identifier rubyid_price'>price</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span> <span class='comment'>#=&gt; :fulfilled
</span>
<span class='comment'># ScheduledTask
</span><span class='id identifier rubyid_task'>task</span> <span class='op'>=</span> <span class='const'>Concurrent</span><span class='op'>::</span><span class='const'>ScheduledTask</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span><span class='lbrace'>{</span> <span class='const'>Ticker</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_get_year_end_closing'>get_year_end_closing</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>INTC</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='int'>2013</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span> <span class='comment'>#=&gt; :pending
</span><span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='int'>3</span><span class='rparen'>)</span>   <span class='comment'># do other stuff
</span><span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='comment'>#=&gt; 25.96
</span></code></pre>

<h3>Scheduling</h3>

<p>The <em>intended</em> schedule time of task execution is set on object construction with first argument. The time can be a numeric (floating point or integer) representing a number of seconds in the future or it can ba a <code>Time</code> object representing the approximate time of execution. Any other value, a numeric equal to or less than zero, or a time in the past will result in an exception. </p>

<p>The <em>actual</em> schedule time of task execution is set when the <code>execute</code> method is called. If the <em>intended</em> schedule time was given as a number of seconds then the <em>actual</em> schedule time will be calculated from the current time. If the <em>intended</em> schedule time was given as a <code>Time</code> object the current time will be checked against the <em>intended</em> schedule time. If the <em>intended</em> schedule time is now in the past an exception will be raised. </p>

<p>The constructor can also be given zero or more processing options. Currently the only supported options are those recognized by the <a href="Dereferenceable">Dereferenceable</a> module. </p>

<p>The final constructor argument is a block representing the task to be performed at the scheduled time. If no block is given an <code>ArgumentError</code> will be raised.</p>

<h4>States</h4>

<p><code>ScheduledTask</code> mixes in the  <a href="Obligation">Obligation</a> module thus giving it &quot;future&quot; behavior. This includes the expected lifecycle states. <code>ScheduledTask</code> has one additional state, however. While the task (block) is being executed the state of the object will be <code>:in_progress</code>. This additional state is  necessary because it has implications for task cancellation. </p>

<h4>Cancellation</h4>

<p>A <code>:pending</code> task can be cancelled using the <code>#cancel</code> method. A task in any other state, including <code>:in_progress</code>, cannot be cancelled. The <code>#cancel</code> method returns a boolean indicating the success of the cancellation attempt. A cancelled <code>ScheduledTask</code> cannot be restarted. It is immutable. </p>

<h3>Obligation and Observation</h3>

<p>The result of a <code>ScheduledTask</code> can be obtained either synchronously or asynchronously. <code>ScheduledTask</code> mixes in both the <a href="Obligation">Obligation</a> module and the <a href="http://ruby-doc.org/stdlib-2.0/libdoc/observer/rdoc/Observable.html">Observable</a> module from the Ruby standard library. With one exception <code>ScheduledTask</code> behaves identically to <a href="Observable">Future</a> with regard to these modules. </p>

<p>Unlike <code>Future</code>, however, an observer added to a <code>ScheduledTask</code> <em>after</em> the task operation has completed will <em>not</em> receive notification. The reason for this is the subtle but important difference in intent between the two abstractions. With a <code>Future</code> there is no way to know when the operation will complete. Therefore the <em>expected</em> behavior of an observer is to be notified. With a <code>ScheduledTask</code> however, the approximate time of execution is known. It is often explicitly set as a constructor argument. It is always available via the <code>#schedule_time</code> attribute reader. Therefore it is always possible for calling code to know whether the observer is being added prior to task execution. It is also easy to add an observer long before task execution begins (since there is never a reason to create a scheduled task that starts immediately). Subsequently, the <em>expectation</em> is that the caller of <code>#add_observer</code> is making the call within an appropriate time. </p>

<h3>Examples</h3>

<p>Successful task execution using seconds for scheduling:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>concurrent</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_task'>task</span> <span class='op'>=</span> <span class='const'>Concurrent</span><span class='op'>::</span><span class='const'>ScheduledTask</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span><span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>What does the fox say?</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span>         <span class='comment'>#=&gt; :unscheduled
</span><span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_schedule_time'>schedule_time</span> <span class='comment'>#=&gt; nil
</span><span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span>
<span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span>         <span class='comment'>#=&gt; pending
</span><span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_schedule_time'>schedule_time</span> <span class='comment'>#=&gt; 2013-11-07 12:20:07 -0500
</span>
<span class='comment'># wait for it...
</span><span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='int'>3</span><span class='rparen'>)</span>

<span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_unscheduled?'>unscheduled?</span> <span class='comment'>#=&gt; false
</span><span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_pending?'>pending?</span>     <span class='comment'>#=&gt; false
</span><span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_fulfilled?'>fulfilled?</span>   <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_rejected?'>rejected?</span>    <span class='comment'>#=&gt; false
</span><span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span>        <span class='comment'>#=&gt; &#39;What does the fox say?&#39;
</span></code></pre>

<p>A <code>ScheduledTask</code> can be created and executed in one line:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_task'>task</span> <span class='op'>=</span> <span class='const'>Concurrent</span><span class='op'>::</span><span class='const'>ScheduledTask</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span><span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>What does the fox say?</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span>
<span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span>         <span class='comment'>#=&gt; pending
</span><span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_schedule_time'>schedule_time</span> <span class='comment'>#=&gt; 2013-11-07 12:20:07 -0500
</span></code></pre>

<p>Failed task execution using a <code>Time</code> object for scheduling:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_t'>t</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>+</span> <span class='int'>2</span>
<span class='id identifier rubyid_task'>task</span> <span class='op'>=</span> <span class='const'>Concurrent</span><span class='op'>::</span><span class='const'>ScheduledTask</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='rparen'>)</span><span class='lbrace'>{</span> <span class='id identifier rubyid_raise'>raise</span> <span class='const'>StandardError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Call me maybe?</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_pending?'>pending?</span>      <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_schedule_time'>schedule_time</span> <span class='comment'>#=&gt; 2013-11-07 12:22:01 -0500
</span>
<span class='comment'># wait for it...
</span><span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='int'>3</span><span class='rparen'>)</span>

<span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_unscheduled?'>unscheduled?</span> <span class='comment'>#=&gt; false
</span><span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_pending?'>pending?</span>     <span class='comment'>#=&gt; false
</span><span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_fulfilled?'>fulfilled?</span>   <span class='comment'>#=&gt; false
</span><span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_rejected?'>rejected?</span>    <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span>        <span class='comment'>#=&gt; nil
</span><span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_reason'>reason</span>       <span class='comment'>#=&gt; #&lt;StandardError: Call me maybe?&gt; 
</span></code></pre>

<p>An exception will be thrown on creation if the schedule time is in the past:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_task'>task</span> <span class='op'>=</span> <span class='const'>Concurrent</span><span class='op'>::</span><span class='const'>ScheduledTask</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>-</span> <span class='int'>10</span><span class='rparen'>)</span><span class='lbrace'>{</span> <span class='kw'>nil</span> <span class='rbrace'>}</span>
  <span class='comment'>#=&gt; ArgumentError: schedule time must be in the future
</span>
<span class='id identifier rubyid_task'>task</span> <span class='op'>=</span> <span class='const'>Concurrent</span><span class='op'>::</span><span class='const'>ScheduledTask</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='op'>-</span><span class='int'>10</span><span class='rparen'>)</span><span class='lbrace'>{</span> <span class='kw'>nil</span> <span class='rbrace'>}</span>
  <span class='comment'>#=&gt; ArgumentError: seconds must be greater than zero
</span></code></pre>

<p>An exception will also be thrown when <code>#execute</code> is called if the current time has
progressed past the intended schedule time:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_task'>task</span> <span class='op'>=</span> <span class='const'>Concurrent</span><span class='op'>::</span><span class='const'>ScheduledTask</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>+</span> <span class='int'>10</span><span class='rparen'>)</span><span class='lbrace'>{</span> <span class='kw'>nil</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='int'>20</span><span class='rparen'>)</span>

<span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span>
  <span class='comment'>#=&gt; ArgumentError: schedule time must be in the future
</span></code></pre>

<p>Task execution with observation:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_observer'>observer</span> <span class='op'>=</span> <span class='const'>Class</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lbrace'>{</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_time'>time</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='id identifier rubyid_reason'>reason</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The task completed at </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_time'>time</span><span class='embexpr_end'>}</span><span class='tstring_content'> with value &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>

<span class='id identifier rubyid_task'>task</span> <span class='op'>=</span> <span class='const'>Concurrent</span><span class='op'>::</span><span class='const'>ScheduledTask</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span><span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>What does the fox say?</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_add_observer'>add_observer</span><span class='lparen'>(</span><span class='id identifier rubyid_observer'>observer</span><span class='rparen'>)</span>
<span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span>
<span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_pending?'>pending?</span>      <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_schedule_time'>schedule_time</span> <span class='comment'>#=&gt; 2013-11-07 12:20:07 -0500
</span>
<span class='comment'># wait for it...
</span><span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='int'>3</span><span class='rparen'>)</span>

<span class='comment'>#&gt;&gt; The task completed at 2013-11-07 12:26:09 -0500 with value &#39;What does the fox say?&#39;
</span></code></pre>
</p>


  </div>
</div>
<div class="tags">
  

</div>
  <h2>Constant Summary</h2>
  




  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="protected ">
  <span class="summary_signature">
    
      <a href="#observers-instance_method" title="#observers (instance method)">- (Object) <strong>observers</strong> </a>
    

    
  </span>
  
    <span class="note title not_defined_here">
      included
      from <span class='object_link'><a href="Observable.html#observers-instance_method" title="Concurrent::Observable#observers (method)">Observable</a></span>
    </span>
  
  
  
    
    
  
  <span class="note title protected">protected</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns the value of attribute observers.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#schedule_time-instance_method" title="#schedule_time (instance method)">- (Object) <strong>schedule_time</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns the value of attribute schedule_time.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#execute-class_method" title="execute (class method)">+ (Object) <strong>execute</strong>(intended_time, opts = {}, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_observer-instance_method" title="#add_observer (instance method)">- (Object) <strong>add_observer</strong>(*args, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cancel-instance_method" title="#cancel (instance method)">- (Object) <strong>cancel</strong> </a>
    

    
      (also: #stop)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cancelled%3F-instance_method" title="#cancelled? (instance method)">- (Boolean) <strong>cancelled?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="protected ">
  <span class="summary_signature">
    
      <a href="#complete-instance_method" title="#complete (instance method)">- (Object) <strong>complete</strong> </a>
    

    
  </span>
  
  
  
  <span class="note title protected">protected</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#execute-instance_method" title="#execute (instance method)">- (Object) <strong>execute</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="protected ">
  <span class="summary_signature">
    
      <a href="#fail-instance_method" title="#fail (instance method)">- (Object) <strong>fail</strong> </a>
    

    
  </span>
  
  
  
  <span class="note title protected">protected</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#in_progress%3F-instance_method" title="#in_progress? (instance method)">- (Boolean) <strong>in_progress?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (ScheduledTask) <strong>initialize</strong>(intended_time, opts = {}, &amp;block) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>A new instance of ScheduledTask.</p>
</div></span>
  
</li>

      
        <li class="protected ">
  <span class="summary_signature">
    
      <a href="#set-instance_method" title="#set (instance method)">- (Object) <strong>set</strong> </a>
    

    
  </span>
  
  
  
  <span class="note title protected">protected</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  <div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Concurrent::ScheduledTask (class)">ScheduledTask</a></span></tt>) <strong>initialize</strong>(intended_time, opts = {}, &amp;block) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns a new instance of ScheduledTask</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


12
13
14
15
16
17
18
19
20
21
22
23</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/concurrent/scheduled_task.rb', line 12</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_intended_time'>intended_time</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>no block given</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
  <span class='const'>TimerSet</span><span class='period'>.</span><span class='id identifier rubyid_calculate_schedule_time'>calculate_schedule_time</span><span class='lparen'>(</span><span class='id identifier rubyid_intended_time'>intended_time</span><span class='rparen'>)</span> <span class='comment'># raises exceptons
</span>
  <span class='kw'>super</span><span class='lparen'>(</span><span class='const'>NO_VALUE</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>

  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_observers'>observers</span> <span class='op'>=</span> <span class='const'>CopyOnNotifyObserverSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@intended_time</span> <span class='op'>=</span> <span class='id identifier rubyid_intended_time'>intended_time</span>
  <span class='ivar'>@state</span>         <span class='op'>=</span> <span class='symbol'>:unscheduled</span>
  <span class='ivar'>@task</span>          <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span>
  <span class='ivar'>@executor</span>      <span class='op'>=</span> <span class='const'>OptionsParser</span><span class='op'>::</span><span class='id identifier rubyid_get_executor_from'>get_executor_from</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='const'>Concurrent</span><span class='period'>.</span><span class='id identifier rubyid_configuration'>configuration</span><span class='period'>.</span><span class='id identifier rubyid_global_operation_pool'>global_operation_pool</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="observers=-instance_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="observers-instance_method">
  
    - (<tt>Object</tt>) <strong>observers</strong>  <span class="extras">(protected)</span>
  

  

  
    <span class="not_defined_here">
      Originally defined in module
        <span class='object_link'><a href="Observable.html#observers-instance_method" title="Concurrent::Observable#observers (method)">Observable</a></span>
    </span>
  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the value of attribute observers</p>


  </div>
</div>
<div class="tags">
  

</div>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="schedule_time-instance_method">
  
    - (<tt>Object</tt>) <strong>schedule_time</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the value of attribute schedule_time</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


10
11
12</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/concurrent/scheduled_task.rb', line 10</span>

<span class='kw'>def</span> <span class='id identifier rubyid_schedule_time'>schedule_time</span>
  <span class='ivar'>@schedule_time</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="execute-class_method">
  
    + (<tt>Object</tt>) <strong>execute</strong>(intended_time, opts = {}, &amp;block) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>0.5.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


35
36
37</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/concurrent/scheduled_task.rb', line 35</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_intended_time'>intended_time</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='const'>ScheduledTask</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_intended_time'>intended_time</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="add_observer-instance_method">
  
    - (<tt>Object</tt>) <strong>add_observer</strong>(*args, &amp;block) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


56
57
58
59
60</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/concurrent/scheduled_task.rb', line 56</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_observer'>add_observer</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_if_state'>if_state</span><span class='lparen'>(</span><span class='symbol'>:unscheduled</span><span class='comma'>,</span> <span class='symbol'>:pending</span><span class='comma'>,</span> <span class='symbol'>:in_progress</span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_observers'>observers</span><span class='period'>.</span><span class='id identifier rubyid_add_observer'>add_observer</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="cancel-instance_method">
  
    - (<tt>Object</tt>) <strong>cancel</strong> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='stop-instance_method'>stop</span></span>
    </span>
  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


47
48
49
50
51
52
53</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/concurrent/scheduled_task.rb', line 47</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cancel'>cancel</span>
  <span class='id identifier rubyid_if_state'>if_state</span><span class='lparen'>(</span><span class='symbol'>:unscheduled</span><span class='comma'>,</span> <span class='symbol'>:pending</span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='ivar'>@state</span> <span class='op'>=</span> <span class='symbol'>:cancelled</span>
    <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span>
    <span class='kw'>true</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="cancelled?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>cancelled?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


39
40
41</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/concurrent/scheduled_task.rb', line 39</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cancelled?'>cancelled?</span>
  <span class='id identifier rubyid_state'>state</span> <span class='op'>==</span> <span class='symbol'>:cancelled</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="complete-instance_method">
  
    - (<tt>Object</tt>) <strong>complete</strong>  <span class="extras">(protected)</span>
  

  

  
</h3>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="execute-instance_method">
  
    - (<tt>Object</tt>) <strong>execute</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>0.5.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


26
27
28
29
30
31
32</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/concurrent/scheduled_task.rb', line 26</span>

<span class='kw'>def</span> <span class='id identifier rubyid_execute'>execute</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_compare_and_set_state'>compare_and_set_state</span><span class='lparen'>(</span><span class='symbol'>:pending</span><span class='comma'>,</span> <span class='symbol'>:unscheduled</span><span class='rparen'>)</span>
    <span class='ivar'>@schedule_time</span> <span class='op'>=</span> <span class='const'>TimerSet</span><span class='period'>.</span><span class='id identifier rubyid_calculate_schedule_time'>calculate_schedule_time</span><span class='lparen'>(</span><span class='ivar'>@intended_time</span><span class='rparen'>)</span>
    <span class='const'>Concurrent</span><span class='op'>::</span><span class='id identifier rubyid_timer'>timer</span><span class='lparen'>(</span><span class='ivar'>@schedule_time</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span> <span class='op'>-</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='ivar'>@executor</span><span class='period'>.</span><span class='id identifier rubyid_post'>post</span> <span class='op'>&amp;</span><span class='id identifier rubyid_method'>method</span><span class='lparen'>(</span><span class='symbol'>:process_task</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
    <span class='kw'>self</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fail-instance_method">
  
    - (<tt>Object</tt>) <strong>fail</strong>  <span class="extras">(protected)</span>
  

  

  
</h3>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="in_progress?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>in_progress?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


43
44
45</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/concurrent/scheduled_task.rb', line 43</span>

<span class='kw'>def</span> <span class='id identifier rubyid_in_progress?'>in_progress?</span>
  <span class='id identifier rubyid_state'>state</span> <span class='op'>==</span> <span class='symbol'>:in_progress</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set-instance_method">
  
    - (<tt>Object</tt>) <strong>set</strong>  <span class="extras">(protected)</span>
  

  

  
</h3>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Wed Nov 26 09:45:05 2014 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.1.5).
</div>

<script>
//  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
//    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
//      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
//  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
//
//  ga('create', 'UA-4005004-8', 'pitr.ch');
//  ga('send', 'pageview');
</script>

  </body>
</html>