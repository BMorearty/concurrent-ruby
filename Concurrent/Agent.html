<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Concurrent::Agent
  
    &mdash; Concurrent
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!Concurrent/Agent.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (A)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span></span>
     &raquo; 
    <span class="title">Agent</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Concurrent::Agent
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Concurrent::Agent</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2"><span class='object_link'><a href="Dereferenceable.html" title="Concurrent::Dereferenceable (module)">Dereferenceable</a></span>, <span class='object_link'><a href="Logging.html" title="Concurrent::Logging (module)">Logging</a></span>, <span class='object_link'><a href="Observable.html" title="Concurrent::Observable (module)">Observable</a></span></dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">lib/concurrent/agent.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>An agent is a single atomic value that represents an identity. The current value
of the agent can be requested at any time (<code>#deref</code>). Each agent has a work queue and operates on
the global thread pool. Consumers can <code>#post</code> code blocks to the agent. The code block (function)
will receive the current value of the agent as its sole parameter. The return value of the block
will become the new value of the agent. Agents support two error handling modes: fail and continue.
A good example of an agent is a shared incrementing counter, such as the score in a video game.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>Basic usage</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_score'>score</span> <span class='op'>=</span> <span class='const'>Concurrent</span><span class='op'>::</span><span class='const'>Agent</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>10</span><span class='rparen'>)</span>
<span class='id identifier rubyid_score'>score</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='comment'>#=&gt; 10
</span>
<span class='id identifier rubyid_score'>score</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_proc'>proc</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_current'>current</span><span class='op'>|</span> <span class='id identifier rubyid_current'>current</span> <span class='op'>+</span> <span class='int'>100</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='float'>0.1</span><span class='rparen'>)</span>
<span class='id identifier rubyid_score'>score</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='comment'>#=&gt; 110
</span>
<span class='id identifier rubyid_score'>score</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_proc'>proc</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_current'>current</span><span class='op'>|</span> <span class='id identifier rubyid_current'>current</span> <span class='op'>*</span> <span class='int'>2</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='float'>0.1</span><span class='rparen'>)</span>
<span class='id identifier rubyid_score'>score</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='comment'>#=&gt; 220
</span>
<span class='id identifier rubyid_score'>score</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_proc'>proc</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_current'>current</span><span class='op'>|</span> <span class='id identifier rubyid_current'>current</span> <span class='op'>-</span> <span class='int'>50</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='float'>0.1</span><span class='rparen'>)</span>
<span class='id identifier rubyid_score'>score</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='comment'>#=&gt; 170</span></code></pre>
    
  </div>


</div>
  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="TIMEOUT-constant" class="">TIMEOUT =
          <div class="docstring">
  <div class="discussion">
    <p>The default timeout value (in seconds); used when no timeout option
is given at initialization</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>5</span></pre></dd>
      
    </dl>
  




  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="protected ">
  <span class="summary_signature">
    
      <a href="#observers-instance_method" title="#observers (instance method)">- (Object) <strong>observers</strong> </a>
    

    
  </span>
  
    <span class="note title not_defined_here">
      included
      from <span class='object_link'><a href="Observable.html#observers-instance_method" title="Concurrent::Observable#observers (method)">Observable</a></span>
    </span>
  
  
  
    
    
  
  <span class="note title protected">protected</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns the value of attribute observers.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#operation_executor-instance_method" title="#operation_executor (instance method)">- (Object) <strong>operation_executor</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns the value of attribute operation_executor.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#task_executor-instance_method" title="#task_executor (instance method)">- (Object) <strong>task_executor</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns the value of attribute task_executor.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#timeout-instance_method" title="#timeout (instance method)">- (Fixnum) <strong>timeout</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The maximum number of seconds before an update is cancelled.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#%3C%3C-instance_method" title="#&lt;&lt; (instance method)">- (Object) <strong>&lt;&lt;</strong>(block) {|value| ... }</a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Update the current value with the result of the given block operation, block should not do blocking calls, use #post_off for blocking calls.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_observer-instance_method" title="#add_observer (instance method)">- (Object) <strong>add_observer</strong>(*args, &amp;block) </a>
    

    
  </span>
  
    <span class="note title not_defined_here">
      included
      from <span class='object_link'><a href="Observable.html#add_observer-instance_method" title="Concurrent::Observable#add_observer (method)">Observable</a></span>
    </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The added observer.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#await-instance_method" title="#await (instance method)">- (Boolean) <strong>await</strong>(timeout = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Waits/blocks until all the updates sent before this call are done.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#count_observers-instance_method" title="#count_observers (instance method)">- (Integer) <strong>count_observers</strong> </a>
    

    
  </span>
  
    <span class="note title not_defined_here">
      included
      from <span class='object_link'><a href="Observable.html#count_observers-instance_method" title="Concurrent::Observable#count_observers (method)">Observable</a></span>
    </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The observers count.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#delete_observer-instance_method" title="#delete_observer (instance method)">- (Object) <strong>delete_observer</strong>(*args) </a>
    

    
  </span>
  
    <span class="note title not_defined_here">
      included
      from <span class='object_link'><a href="Observable.html#delete_observer-instance_method" title="Concurrent::Observable#delete_observer (method)">Observable</a></span>
    </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The deleted observer.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#delete_observers-instance_method" title="#delete_observers (instance method)">- (Observable) <strong>delete_observers</strong> </a>
    

    
  </span>
  
    <span class="note title not_defined_here">
      included
      from <span class='object_link'><a href="Observable.html#delete_observers-instance_method" title="Concurrent::Observable#delete_observers (method)">Observable</a></span>
    </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Self.</p>
</div></span>
  
</li>

      
        <li class="protected ">
  <span class="summary_signature">
    
      <a href="#init_mutex-instance_method" title="#init_mutex (instance method)">- (Object) <strong>init_mutex</strong> </a>
    

    
  </span>
  
    <span class="note title not_defined_here">
      included
      from <span class='object_link'><a href="Dereferenceable.html#init_mutex-instance_method" title="Concurrent::Dereferenceable#init_mutex (method)">Dereferenceable</a></span>
    </span>
  
  
  
  <span class="note title protected">protected</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Initializes the internal <code>Mutex</code>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Agent) <strong>initialize</strong>(initial, opts = {}) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Initialize a new Agent with the given initial value and provided options.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#log-instance_method" title="#log (instance method)">- (Object) <strong>log</strong>(level, progname, message = nil, &amp;block) </a>
    

    
  </span>
  
    <span class="note title not_defined_here">
      included
      from <span class='object_link'><a href="Logging.html#log-instance_method" title="Concurrent::Logging#log (method)">Logging</a></span>
    </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Logs through <span class='object_link'><a href="Configuration.html#logger-instance_method" title="Concurrent::Configuration#logger (method)">Configuration#logger</a></span>, it can be overridden by setting @logger.</p>
</div></span>
  
</li>

      
        <li class="protected ">
  <span class="summary_signature">
    
      <a href="#mutex-instance_method" title="#mutex (instance method)">- (Mutex) <strong>mutex</strong> </a>
    

    
  </span>
  
    <span class="note title not_defined_here">
      included
      from <span class='object_link'><a href="Dereferenceable.html#mutex-instance_method" title="Concurrent::Dereferenceable#mutex (method)">Dereferenceable</a></span>
    </span>
  
  
  
  <span class="note title protected">protected</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>A mutex lock used for synchronizing thread-safe operations.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#post-instance_method" title="#post (instance method)">- (true<sup>?</sup>) <strong>post</strong> {|value| ... }</a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Update the current value with the result of the given block operation, block should not do blocking calls, use #post_off for blocking calls.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#post_off-instance_method" title="#post_off (instance method)">- (true<sup>?</sup>) <strong>post_off</strong> {|value| ... }</a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Update the current value with the result of the given block operation, block can do blocking calls.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#rescue-instance_method" title="#rescue (instance method)">- (Object) <strong>rescue</strong>(clazz = StandardError) {|ex| ... }</a>
    

    
      (also: #catch, #on_error)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Specifies a block operation to be performed when an update operation raises an exception.</p>
</div></span>
  
</li>

      
        <li class="protected ">
  <span class="summary_signature">
    
      <a href="#set_deref_options-instance_method" title="#set_deref_options (instance method)">- (Object) <strong>set_deref_options</strong>(opts = {}) </a>
    

    
  </span>
  
    <span class="note title not_defined_here">
      included
      from <span class='object_link'><a href="Dereferenceable.html#set_deref_options-instance_method" title="Concurrent::Dereferenceable#set_deref_options (method)">Dereferenceable</a></span>
    </span>
  
  
  
  <span class="note title protected">protected</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Set the options which define the operations #value performs before returning data to the caller (dereferencing).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#validate-instance_method" title="#validate (instance method)">- (Object) <strong>validate</strong> {|value| ... }</a>
    

    
      (also: #validates, #validate_with, #validates_with)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>A block operation to be performed after every update to validate if the new value is valid.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#value-instance_method" title="#value (instance method)">- (Object) <strong>value</strong> </a>
    

    
      (also: #deref)
    
  </span>
  
    <span class="note title not_defined_here">
      included
      from <span class='object_link'><a href="Dereferenceable.html#value-instance_method" title="Concurrent::Dereferenceable#value (method)">Dereferenceable</a></span>
    </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Return the value this object represents after applying the options specified by the <code>#set_deref_options</code> method.</p>
</div></span>
  
</li>

      
        <li class="protected ">
  <span class="summary_signature">
    
      <a href="#value%3D-instance_method" title="#value= (instance method)">- (Object) <strong>value=</strong>(val) </a>
    

    
  </span>
  
    <span class="note title not_defined_here">
      included
      from <span class='object_link'><a href="Dereferenceable.html#value%3D-instance_method" title="Concurrent::Dereferenceable#value= (method)">Dereferenceable</a></span>
    </span>
  
  
  
  <span class="note title protected">protected</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Set the internal value of this object.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#with_observer-instance_method" title="#with_observer (instance method)">- (Observable) <strong>with_observer</strong>(*args, &amp;block) </a>
    

    
  </span>
  
    <span class="note title not_defined_here">
      included
      from <span class='object_link'><a href="Observable.html#with_observer-instance_method" title="Concurrent::Observable#with_observer (method)">Observable</a></span>
    </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>as #add_observer but it can be used for chaining.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  <div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Concurrent::Agent (class)">Agent</a></span></tt>) <strong>initialize</strong>(initial, opts = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Initialize a new Agent with the given initial value and provided options.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>initial</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the initial value</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>the options used to define the behavior at update and deref</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>opts</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:timeout</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>TIMEOUT</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>maximum number of seconds before an update is cancelled</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:operation</span>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>when <code>true</code> will execute the future on the global
operation pool (for long-running operations), when <code>false</code> will execute the future on the
global task pool (for short-running tasks)</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:executor</span>
          <span class="type">(<tt>object</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>when provided will run all operations on
this executor rather than the global thread pool (overrides :operation)</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:dup_on_deref</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>call <code>#dup</code> before returning the data</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:freeze_on_deref</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>call <code>#freeze</code> before returning the data</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:copy_on_deref</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>nil</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>call the given <code>Proc</code> passing the internal value and
returning the value returned from the proc</p>
</div>
          
        </li>
      
    </ul>
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


64
65
66
67
68
69
70
71
72
73
74
75</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/concurrent/agent.rb', line 64</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_initial'>initial</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='ivar'>@value</span>                <span class='op'>=</span> <span class='id identifier rubyid_initial'>initial</span>
  <span class='ivar'>@rescuers</span>             <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='ivar'>@validator</span>            <span class='op'>=</span> <span class='const'>Proc</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_result'>result</span><span class='op'>|</span> <span class='kw'>true</span> <span class='rbrace'>}</span>
  <span class='ivar'>@timeout</span>              <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:timeout</span><span class='comma'>,</span> <span class='const'>TIMEOUT</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_observers'>observers</span>        <span class='op'>=</span> <span class='const'>CopyOnWriteObserverSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@serialized_execution</span> <span class='op'>=</span> <span class='const'>SerializedExecution</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@task_executor</span>        <span class='op'>=</span> <span class='const'>OptionsParser</span><span class='period'>.</span><span class='id identifier rubyid_get_task_executor_from'>get_task_executor_from</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
  <span class='ivar'>@operation_executor</span>   <span class='op'>=</span> <span class='const'>OptionsParser</span><span class='period'>.</span><span class='id identifier rubyid_get_operation_executor_from'>get_operation_executor_from</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_init_mutex'>init_mutex</span>
  <span class='id identifier rubyid_set_deref_options'>set_deref_options</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="observers=-instance_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="observers-instance_method">
  
    - (<tt>Object</tt>) <strong>observers</strong>  <span class="extras">(protected)</span>
  

  

  
    <span class="not_defined_here">
      Originally defined in module
        <span class='object_link'><a href="Observable.html#observers-instance_method" title="Concurrent::Observable#observers (method)">Observable</a></span>
    </span>
  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the value of attribute observers</p>


  </div>
</div>
<div class="tags">
  

</div>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="operation_executor-instance_method">
  
    - (<tt>Object</tt>) <strong>operation_executor</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the value of attribute operation_executor</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


45
46
47</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/concurrent/agent.rb', line 45</span>

<span class='kw'>def</span> <span class='id identifier rubyid_operation_executor'>operation_executor</span>
  <span class='ivar'>@operation_executor</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="task_executor-instance_method">
  
    - (<tt>Object</tt>) <strong>task_executor</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the value of attribute task_executor</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


45
46
47</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/concurrent/agent.rb', line 45</span>

<span class='kw'>def</span> <span class='id identifier rubyid_task_executor'>task_executor</span>
  <span class='ivar'>@task_executor</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="timeout-instance_method">
  
    - (<tt>Fixnum</tt>) <strong>timeout</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the maximum number of seconds before an update is cancelled</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the maximum number of seconds before an update is cancelled</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/concurrent/agent.rb', line 36</span>

<span class='kw'>class</span> <span class='const'>Agent</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Dereferenceable</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Concurrent</span><span class='op'>::</span><span class='const'>Observable</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Logging</span>

  <span class='comment'># The default timeout value (in seconds); used when no timeout option
</span>  <span class='comment'># is given at initialization
</span>  <span class='const'>TIMEOUT</span> <span class='op'>=</span> <span class='int'>5</span>

  <span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbol'>:timeout</span><span class='comma'>,</span> <span class='symbol'>:task_executor</span><span class='comma'>,</span> <span class='symbol'>:operation_executor</span>

  <span class='comment'># Initialize a new Agent with the given initial value and provided options.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Object] initial the initial value
</span>  <span class='comment'># @param [Hash] opts the options used to define the behavior at update and deref
</span>  <span class='comment'>#
</span>  <span class='comment'># @option opts [Fixnum] :timeout (TIMEOUT) maximum number of seconds before an update is cancelled
</span>  <span class='comment'>#
</span>  <span class='comment'># @option opts [Boolean] :operation (false) when `true` will execute the future on the global
</span>  <span class='comment'>#   operation pool (for long-running operations), when `false` will execute the future on the
</span>  <span class='comment'>#   global task pool (for short-running tasks)
</span>  <span class='comment'># @option opts [object] :executor when provided will run all operations on
</span>  <span class='comment'>#   this executor rather than the global thread pool (overrides :operation)
</span>  <span class='comment'>#
</span>  <span class='comment'># @option opts [String] :dup_on_deref (false) call `#dup` before returning the data
</span>  <span class='comment'># @option opts [String] :freeze_on_deref (false) call `#freeze` before returning the data
</span>  <span class='comment'># @option opts [String] :copy_on_deref (nil) call the given `Proc` passing the internal value and
</span>  <span class='comment'>#   returning the value returned from the proc
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_initial'>initial</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='ivar'>@value</span>                <span class='op'>=</span> <span class='id identifier rubyid_initial'>initial</span>
    <span class='ivar'>@rescuers</span>             <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='ivar'>@validator</span>            <span class='op'>=</span> <span class='const'>Proc</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_result'>result</span><span class='op'>|</span> <span class='kw'>true</span> <span class='rbrace'>}</span>
    <span class='ivar'>@timeout</span>              <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:timeout</span><span class='comma'>,</span> <span class='const'>TIMEOUT</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_observers'>observers</span>        <span class='op'>=</span> <span class='const'>CopyOnWriteObserverSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='ivar'>@serialized_execution</span> <span class='op'>=</span> <span class='const'>SerializedExecution</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='ivar'>@task_executor</span>        <span class='op'>=</span> <span class='const'>OptionsParser</span><span class='period'>.</span><span class='id identifier rubyid_get_task_executor_from'>get_task_executor_from</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
    <span class='ivar'>@operation_executor</span>   <span class='op'>=</span> <span class='const'>OptionsParser</span><span class='period'>.</span><span class='id identifier rubyid_get_operation_executor_from'>get_operation_executor_from</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_init_mutex'>init_mutex</span>
    <span class='id identifier rubyid_set_deref_options'>set_deref_options</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Specifies a block operation to be performed when an update operation raises
</span>  <span class='comment'># an exception. Rescue blocks will be checked in order they were added. The first
</span>  <span class='comment'># block for which the raised exception &quot;is-a&quot; subclass of the given `clazz` will
</span>  <span class='comment'># be called. If no `clazz` is given the block will match any caught exception.
</span>  <span class='comment'># This behavior is intended to be identical to Ruby&#39;s `begin/rescue/end` behavior.
</span>  <span class='comment'># Any number of rescue handlers can be added. If no rescue handlers are added then
</span>  <span class='comment'># caught exceptions will be suppressed.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Exception] clazz the class of exception to catch
</span>  <span class='comment'># @yield the block to be called when a matching exception is caught
</span>  <span class='comment'># @yieldparam [StandardError] ex the caught exception
</span>  <span class='comment'>#
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   score = Concurrent::Agent.new(0).
</span>  <span class='comment'>#             rescue(NoMethodError){|ex| puts &quot;Bam!&quot; }.
</span>  <span class='comment'>#             rescue(ArgumentError){|ex| puts &quot;Pow!&quot; }.
</span>  <span class='comment'>#             rescue{|ex| puts &quot;Boom!&quot; }
</span>  <span class='comment'>#   
</span>  <span class='comment'>#   score &lt;&lt; proc{|current| raise ArgumentError }
</span>  <span class='comment'>#   sleep(0.1)
</span>  <span class='comment'>#   #=&gt; puts &quot;Pow!&quot;
</span>  <span class='kw'>def</span> <span class='kw'>rescue</span><span class='lparen'>(</span><span class='id identifier rubyid_clazz'>clazz</span> <span class='op'>=</span> <span class='const'>StandardError</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_mutex'>mutex</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
        <span class='ivar'>@rescuers</span> <span class='op'>&lt;&lt;</span> <span class='const'>Rescuer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_clazz'>clazz</span><span class='comma'>,</span> <span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='kw'>self</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_alias_method'>alias_method</span> <span class='symbol'>:catch</span><span class='comma'>,</span> <span class='symbol'>:rescue</span>
  <span class='id identifier rubyid_alias_method'>alias_method</span> <span class='symbol'>:on_error</span><span class='comma'>,</span> <span class='symbol'>:rescue</span>

  <span class='comment'># A block operation to be performed after every update to validate if the new
</span>  <span class='comment'># value is valid. If the new value is not valid then the current value is not
</span>  <span class='comment'># updated. If no validator is provided then all updates are considered valid.
</span>  <span class='comment'>#
</span>  <span class='comment'># @yield the block to be called after every update operation to determine if
</span>  <span class='comment'>#   the result is valid
</span>  <span class='comment'># @yieldparam [Object] value the result of the last update operation
</span>  <span class='comment'># @yieldreturn [Boolean] true if the value is valid else false
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_validate'>validate</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>

    <span class='kw'>unless</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_mutex'>mutex</span><span class='period'>.</span><span class='id identifier rubyid_lock'>lock</span>
        <span class='ivar'>@validator</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span>
      <span class='kw'>ensure</span>
        <span class='id identifier rubyid_mutex'>mutex</span><span class='period'>.</span><span class='id identifier rubyid_unlock'>unlock</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='kw'>self</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_alias_method'>alias_method</span> <span class='symbol'>:validates</span><span class='comma'>,</span> <span class='symbol'>:validate</span>
  <span class='id identifier rubyid_alias_method'>alias_method</span> <span class='symbol'>:validate_with</span><span class='comma'>,</span> <span class='symbol'>:validate</span>
  <span class='id identifier rubyid_alias_method'>alias_method</span> <span class='symbol'>:validates_with</span><span class='comma'>,</span> <span class='symbol'>:validate</span>

  <span class='comment'># Update the current value with the result of the given block operation,
</span>  <span class='comment'># block should not do blocking calls, use #post_off for blocking calls
</span>  <span class='comment'>#
</span>  <span class='comment'># @yield the operation to be performed with the current value in order to calculate
</span>  <span class='comment'>#   the new value
</span>  <span class='comment'># @yieldparam [Object] value the current value
</span>  <span class='comment'># @yieldreturn [Object] the new value
</span>  <span class='comment'># @return [true, nil] nil when no block is given
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_post'>post</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_post_on'>post_on</span><span class='lparen'>(</span><span class='ivar'>@task_executor</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Update the current value with the result of the given block operation,
</span>  <span class='comment'># block can do blocking calls
</span>  <span class='comment'>#
</span>  <span class='comment'># @yield the operation to be performed with the current value in order to calculate
</span>  <span class='comment'>#   the new value
</span>  <span class='comment'># @yieldparam [Object] value the current value
</span>  <span class='comment'># @yieldreturn [Object] the new value
</span>  <span class='comment'># @return [true, nil] nil when no block is given
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_post_off'>post_off</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_post_on'>post_on</span><span class='lparen'>(</span><span class='ivar'>@operation_executor</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Update the current value with the result of the given block operation,
</span>  <span class='comment'># block should not do blocking calls, use #post_off for blocking calls
</span>  <span class='comment'>#
</span>  <span class='comment'># @yield the operation to be performed with the current value in order to calculate
</span>  <span class='comment'>#   the new value
</span>  <span class='comment'># @yieldparam [Object] value the current value
</span>  <span class='comment'># @yieldreturn [Object] the new value
</span>  <span class='kw'>def</span> <span class='op'>&lt;&lt;</span><span class='lparen'>(</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_post'>post</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='comment'># Waits/blocks until all the updates sent before this call are done.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Numeric] timeout the maximum time in second to wait.
</span>  <span class='comment'># @return [Boolean] false on timeout, true otherwise
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_await'>await</span><span class='lparen'>(</span><span class='id identifier rubyid_timeout'>timeout</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_done'>done</span> <span class='op'>=</span> <span class='const'>Event</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_post'>post</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_val'>val</span><span class='op'>|</span> <span class='id identifier rubyid_done'>done</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='semicolon'>;</span> <span class='id identifier rubyid_val'>val</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_done'>done</span><span class='period'>.</span><span class='id identifier rubyid_wait'>wait</span> <span class='id identifier rubyid_timeout'>timeout</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_private'>private</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_post_on'>post_on</span><span class='lparen'>(</span><span class='id identifier rubyid_executor'>executor</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='ivar'>@serialized_execution</span><span class='period'>.</span><span class='id identifier rubyid_post'>post</span><span class='lparen'>(</span><span class='id identifier rubyid_executor'>executor</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_work'>work</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
    <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='comment'># @!visibility private
</span>  <span class='const'>Rescuer</span> <span class='op'>=</span> <span class='const'>Struct</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:clazz</span><span class='comma'>,</span> <span class='symbol'>:block</span><span class='rparen'>)</span> <span class='comment'># :nodoc:
</span>
  <span class='comment'># @!visibility private
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_try_rescue'>try_rescue</span><span class='lparen'>(</span><span class='id identifier rubyid_ex'>ex</span><span class='rparen'>)</span> <span class='comment'># :nodoc:
</span>    <span class='id identifier rubyid_rescuer'>rescuer</span> <span class='op'>=</span> <span class='id identifier rubyid_mutex'>mutex</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
      <span class='ivar'>@rescuers</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span> <span class='id identifier rubyid_ex'>ex</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_clazz'>clazz</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_rescuer'>rescuer</span><span class='period'>.</span><span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_ex'>ex</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_rescuer'>rescuer</span>
  <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ex'>ex</span>
    <span class='comment'># suppress
</span>    <span class='id identifier rubyid_log'>log</span> <span class='const'>DEBUG</span><span class='comma'>,</span> <span class='id identifier rubyid_ex'>ex</span>
  <span class='kw'>end</span>

  <span class='comment'># @!visibility private
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_work'>work</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_handler'>handler</span><span class='rparen'>)</span> <span class='comment'># :nodoc:
</span>    <span class='id identifier rubyid_validator'>validator</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_mutex'>mutex</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='lbrace'>{</span> <span class='lbracket'>[</span><span class='ivar'>@validator</span><span class='comma'>,</span> <span class='ivar'>@value</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>

    <span class='kw'>begin</span>
      <span class='id identifier rubyid_result'>result</span><span class='comma'>,</span> <span class='id identifier rubyid_valid'>valid</span> <span class='op'>=</span> <span class='const'>Concurrent</span><span class='op'>::</span><span class='id identifier rubyid_timeout'>timeout</span><span class='lparen'>(</span><span class='ivar'>@timeout</span><span class='rparen'>)</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_handler'>handler</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
        <span class='lbracket'>[</span><span class='id identifier rubyid_result'>result</span><span class='comma'>,</span> <span class='id identifier rubyid_validator'>validator</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>
    <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ex'>ex</span>
      <span class='id identifier rubyid_exception'>exception</span> <span class='op'>=</span> <span class='id identifier rubyid_ex'>ex</span>
    <span class='kw'>end</span>

    <span class='kw'>begin</span>
      <span class='id identifier rubyid_mutex'>mutex</span><span class='period'>.</span><span class='id identifier rubyid_lock'>lock</span>
      <span class='id identifier rubyid_should_notify'>should_notify</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_exception'>exception</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_valid'>valid</span>
                        <span class='ivar'>@value</span> <span class='op'>=</span> <span class='id identifier rubyid_result'>result</span>
                        <span class='kw'>true</span>
                      <span class='kw'>end</span>
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_mutex'>mutex</span><span class='period'>.</span><span class='id identifier rubyid_unlock'>unlock</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_should_notify'>should_notify</span>
      <span class='id identifier rubyid_time'>time</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
      <span class='id identifier rubyid_observers'>observers</span><span class='period'>.</span><span class='id identifier rubyid_notify_observers'>notify_observers</span> <span class='lbrace'>{</span> <span class='lbracket'>[</span><span class='id identifier rubyid_time'>time</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_try_rescue'>try_rescue</span><span class='lparen'>(</span><span class='id identifier rubyid_exception'>exception</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="<<-instance_method">
  
    - (<tt>Object</tt>) <strong>&lt;&lt;</strong>(block) {|value| ... }
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Update the current value with the result of the given block operation,
block should not do blocking calls, use #post_off for blocking calls</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'><p>the operation to be performed with the current value in order to calculate
the new value</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the current value</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Returns:</p>
<ul class="yieldreturn">
  
    <li>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the new value</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


164
165
166
167</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/concurrent/agent.rb', line 164</span>

<span class='kw'>def</span> <span class='op'>&lt;&lt;</span><span class='lparen'>(</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_post'>post</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="add_observer-instance_method">
  
    - (<tt>Object</tt>) <strong>add_observer</strong>(*args, &amp;block) 
  

  

  
    <span class="not_defined_here">
      Originally defined in module
        <span class='object_link'><a href="Observable.html#add_observer-instance_method" title="Concurrent::Observable#add_observer (method)">Observable</a></span>
    </span>
  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the added observer</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the added observer</p>
</div>
      
    </li>
  
</ul>

</div>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="await-instance_method">
  
    - (<tt>Boolean</tt>) <strong>await</strong>(timeout = nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Waits/blocks until all the updates sent before this call are done.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>timeout</span>
      
      
        <span class='type'>(<tt>Numeric</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>the maximum time in second to wait.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>false on timeout, true otherwise</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


173
174
175
176
177</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/concurrent/agent.rb', line 173</span>

<span class='kw'>def</span> <span class='id identifier rubyid_await'>await</span><span class='lparen'>(</span><span class='id identifier rubyid_timeout'>timeout</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_done'>done</span> <span class='op'>=</span> <span class='const'>Event</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_post'>post</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_val'>val</span><span class='op'>|</span> <span class='id identifier rubyid_done'>done</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='semicolon'>;</span> <span class='id identifier rubyid_val'>val</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_done'>done</span><span class='period'>.</span><span class='id identifier rubyid_wait'>wait</span> <span class='id identifier rubyid_timeout'>timeout</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="count_observers-instance_method">
  
    - (<tt>Integer</tt>) <strong>count_observers</strong> 
  

  

  
    <span class="not_defined_here">
      Originally defined in module
        <span class='object_link'><a href="Observable.html#count_observers-instance_method" title="Concurrent::Observable#count_observers (method)">Observable</a></span>
    </span>
  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the observers count</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the observers count</p>
</div>
      
    </li>
  
</ul>

</div>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="delete_observer-instance_method">
  
    - (<tt>Object</tt>) <strong>delete_observer</strong>(*args) 
  

  

  
    <span class="not_defined_here">
      Originally defined in module
        <span class='object_link'><a href="Observable.html#delete_observer-instance_method" title="Concurrent::Observable#delete_observer (method)">Observable</a></span>
    </span>
  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the deleted observer</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the deleted observer</p>
</div>
      
    </li>
  
</ul>

</div>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="delete_observers-instance_method">
  
    - (<tt><span class='object_link'><a href="Observable.html" title="Concurrent::Observable (module)">Observable</a></span></tt>) <strong>delete_observers</strong> 
  

  

  
    <span class="not_defined_here">
      Originally defined in module
        <span class='object_link'><a href="Observable.html#delete_observers-instance_method" title="Concurrent::Observable#delete_observers (method)">Observable</a></span>
    </span>
  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns self</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Observable.html" title="Concurrent::Observable (module)">Observable</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>self</p>
</div>
      
    </li>
  
</ul>

</div>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="init_mutex-instance_method">
  
    - (<tt>Object</tt>) <strong>init_mutex</strong>  <span class="extras">(protected)</span>
  

  

  
    <span class="not_defined_here">
      Originally defined in module
        <span class='object_link'><a href="Dereferenceable.html#init_mutex-instance_method" title="Concurrent::Dereferenceable#init_mutex (method)">Dereferenceable</a></span>
    </span>
  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>This method <em>must</em> be called from within the constructor of the including class.</p>
</div>
  </div>

<p>Initializes the internal <code>Mutex</code>.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="Dereferenceable.html#mutex-instance_method" title="Concurrent::Dereferenceable#mutex (method)">#mutex</a></span></li>
    
  </ul>

</div>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="log-instance_method">
  
    - (<tt>Object</tt>) <strong>log</strong>(level, progname, message = nil, &amp;block) 
  

  

  
    <span class="not_defined_here">
      Originally defined in module
        <span class='object_link'><a href="Logging.html#log-instance_method" title="Concurrent::Logging#log (method)">Logging</a></span>
    </span>
  
</h3><div class="docstring">
  <div class="discussion">
    <p>Logs through <span class='object_link'><a href="Configuration.html#logger-instance_method" title="Concurrent::Configuration#logger (method)">Configuration#logger</a></span>, it can be overridden by setting @logger</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>level</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>one of Logger::Severity constants</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>progname</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>e.g. a path of an Actor</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>message</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>when nil block is used to generate the message</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Yield Returns:</p>
<ul class="yieldreturn">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>a message</p>
</div>
      
    </li>
  
</ul>

</div>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="mutex-instance_method">
  
    - (<tt>Mutex</tt>) <strong>mutex</strong>  <span class="extras">(protected)</span>
  

  

  
    <span class="not_defined_here">
      Originally defined in module
        <span class='object_link'><a href="Dereferenceable.html#mutex-instance_method" title="Concurrent::Dereferenceable#mutex (method)">Dereferenceable</a></span>
    </span>
  
</h3><div class="docstring">
  <div class="discussion">
    <p>A mutex lock used for synchronizing thread-safe operations. Methods defined
by <code>Dereferenceable</code> are synchronized using the <code>Mutex</code> returned from this
method. Operations performed by the including class that operate on the
<code>@value</code> instance variable should be locked with this <code>Mutex</code>.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Mutex</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the synchronization object</p>
</div>
      
    </li>
  
</ul>

</div>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="post-instance_method">
  
    - (<tt>true</tt><sup>?</sup>) <strong>post</strong> {|value| ... }
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Update the current value with the result of the given block operation,
block should not do blocking calls, use #post_off for blocking calls</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'><p>the operation to be performed with the current value in order to calculate
the new value</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the current value</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Returns:</p>
<ul class="yieldreturn">
  
    <li>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the new value</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>nil when no block is given</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


141
142
143</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/concurrent/agent.rb', line 141</span>

<span class='kw'>def</span> <span class='id identifier rubyid_post'>post</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_post_on'>post_on</span><span class='lparen'>(</span><span class='ivar'>@task_executor</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="post_off-instance_method">
  
    - (<tt>true</tt><sup>?</sup>) <strong>post_off</strong> {|value| ... }
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Update the current value with the result of the given block operation,
block can do blocking calls</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'><p>the operation to be performed with the current value in order to calculate
the new value</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the current value</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Returns:</p>
<ul class="yieldreturn">
  
    <li>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the new value</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>nil when no block is given</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


153
154
155</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/concurrent/agent.rb', line 153</span>

<span class='kw'>def</span> <span class='id identifier rubyid_post_off'>post_off</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_post_on'>post_on</span><span class='lparen'>(</span><span class='ivar'>@operation_executor</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="rescue-instance_method">
  
    - (<tt>Object</tt>) <strong>rescue</strong>(clazz = StandardError) {|ex| ... }
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='catch-instance_method'>catch</span>, <span id='on_error-instance_method'>on_error</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Specifies a block operation to be performed when an update operation raises
an exception. Rescue blocks will be checked in order they were added. The first
block for which the raised exception &quot;is-a&quot; subclass of the given <code>clazz</code> will
be called. If no <code>clazz</code> is given the block will match any caught exception.
This behavior is intended to be identical to Ruby&#39;s <code>begin/rescue/end</code> behavior.
Any number of rescue handlers can be added. If no rescue handlers are added then
caught exceptions will be suppressed.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_score'>score</span> <span class='op'>=</span> <span class='const'>Concurrent</span><span class='op'>::</span><span class='const'>Agent</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span><span class='period'>.</span>
          <span class='id identifier rubyid_rescue'>rescue</span><span class='lparen'>(</span><span class='const'>NoMethodError</span><span class='rparen'>)</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_ex'>ex</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Bam!</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span><span class='period'>.</span>
          <span class='id identifier rubyid_rescue'>rescue</span><span class='lparen'>(</span><span class='const'>ArgumentError</span><span class='rparen'>)</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_ex'>ex</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Pow!</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span><span class='period'>.</span>
          <span class='id identifier rubyid_rescue'>rescue</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_ex'>ex</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Boom!</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>

<span class='id identifier rubyid_score'>score</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_proc'>proc</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_current'>current</span><span class='op'>|</span> <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='float'>0.1</span><span class='rparen'>)</span>
<span class='comment'>#=&gt; puts &quot;Pow!&quot;</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>clazz</span>
      
      
        <span class='type'>(<tt>Exception</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>StandardError</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>the class of exception to catch</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'><p>the block to be called when a matching exception is caught</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>ex</span>
      
      
        <span class='type'>(<tt>StandardError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the caught exception</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


98
99
100
101
102
103
104
105</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/concurrent/agent.rb', line 98</span>

<span class='kw'>def</span> <span class='kw'>rescue</span><span class='lparen'>(</span><span class='id identifier rubyid_clazz'>clazz</span> <span class='op'>=</span> <span class='const'>StandardError</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_mutex'>mutex</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
      <span class='ivar'>@rescuers</span> <span class='op'>&lt;&lt;</span> <span class='const'>Rescuer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_clazz'>clazz</span><span class='comma'>,</span> <span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_deref_options-instance_method">
  
    - (<tt>Object</tt>) <strong>set_deref_options</strong>(opts = {})  <span class="extras">(protected)</span>
  

  

  
    <span class="not_defined_here">
      Originally defined in module
        <span class='object_link'><a href="Dereferenceable.html#set_deref_options-instance_method" title="Concurrent::Dereferenceable#set_deref_options (method)">Dereferenceable</a></span>
    </span>
  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>Most classes that include this module will call <code>#set_deref_options</code></p>
</div>
  </div>

<p>Set the options which define the operations #value performs before
returning data to the caller (dereferencing).</p>

<p>from within the constructor, thus allowing these options to be set at
object creation.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>the options defining dereference behavior.</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <p class="tag_title">Options Hash (<tt>opts</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:dup_on_deref</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>call <code>#dup</code> before returning the data</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:freeze_on_deref</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>call <code>#freeze</code> before returning the data</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:copy_on_deref</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>nil</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>call the given <code>Proc</code> passing the internal value and
returning the value returned from the proc</p>
</div>
          
        </li>
      
    </ul>
  


</div>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="validate-instance_method">
  
    - (<tt>Object</tt>) <strong>validate</strong> {|value| ... }
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='validates-instance_method'>validates</span>, <span id='validate_with-instance_method'>validate_with</span>, <span id='validates_with-instance_method'>validates_with</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>A block operation to be performed after every update to validate if the new
value is valid. If the new value is not valid then the current value is not
updated. If no validator is provided then all updates are considered valid.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'><p>the block to be called after every update operation to determine if
the result is valid</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the result of the last update operation</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Returns:</p>
<ul class="yieldreturn">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>true if the value is valid else false</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


117
118
119
120
121
122
123
124
125
126
127
128</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/concurrent/agent.rb', line 117</span>

<span class='kw'>def</span> <span class='id identifier rubyid_validate'>validate</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_mutex'>mutex</span><span class='period'>.</span><span class='id identifier rubyid_lock'>lock</span>
      <span class='ivar'>@validator</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span>
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_mutex'>mutex</span><span class='period'>.</span><span class='id identifier rubyid_unlock'>unlock</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="value-instance_method">
  
    - (<tt>Object</tt>) <strong>value</strong> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='deref-instance_method'>deref</span></span>
    </span>
  

  
    <span class="not_defined_here">
      Originally defined in module
        <span class='object_link'><a href="Dereferenceable.html#value-instance_method" title="Concurrent::Dereferenceable#value (method)">Dereferenceable</a></span>
    </span>
  
</h3><div class="docstring">
  <div class="discussion">
    <p>Return the value this object represents after applying the options specified
by the <code>#set_deref_options</code> method.</p>

<p>When multiple deref options are set the order of operations is strictly defined.
The order of deref operations is:
* <code>:copy_on_deref</code>
* <code>:dup_on_deref</code>
* <code>:freeze_on_deref</code></p>

<p>Because of this ordering there is no need to <code>#freeze</code> an object created by a
provided <code>:copy_on_deref</code> block. Simply set <code>:freeze_on_deref</code> to <code>true</code>.
Setting both <code>:dup_on_deref</code> to <code>true</code> and <code>:freeze_on_deref</code> to <code>true</code> is
as close to the behavior of a &quot;pure&quot; functional language (like Erlang, Clojure,
or Haskell) as we are likely to get in Ruby.</p>

<p>This method is thread-safe and synchronized with the internal <code>#mutex</code>.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the current value of the object</p>
</div>
      
    </li>
  
</ul>

</div>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="value=-instance_method">
  
    - (<tt>Object</tt>) <strong>value=</strong>(val)  <span class="extras">(protected)</span>
  

  

  
    <span class="not_defined_here">
      Originally defined in module
        <span class='object_link'><a href="Dereferenceable.html#value%3D-instance_method" title="Concurrent::Dereferenceable#value= (method)">Dereferenceable</a></span>
    </span>
  
</h3><div class="docstring">
  <div class="discussion">
    <p>Set the internal value of this object</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>val</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the new value</p>
</div>
      
    </li>
  
</ul>


</div>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="with_observer-instance_method">
  
    - (<tt><span class='object_link'><a href="Observable.html" title="Concurrent::Observable (module)">Observable</a></span></tt>) <strong>with_observer</strong>(*args, &amp;block) 
  

  

  
    <span class="not_defined_here">
      Originally defined in module
        <span class='object_link'><a href="Observable.html#with_observer-instance_method" title="Concurrent::Observable#with_observer (method)">Observable</a></span>
    </span>
  
</h3><div class="docstring">
  <div class="discussion">
    <p>as #add_observer but it can be used for chaining</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Observable.html" title="Concurrent::Observable (module)">Observable</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>self</p>
</div>
      
    </li>
  
</ul>

</div>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Sat Jun 14 12:51:08 2014 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.4 (ruby-2.1.0).
</div>

<script>
//  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
//    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
//      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
//  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
//
//  ga('create', 'UA-4005004-8', 'pitr.ch');
//  ga('send', 'pageview');
</script>

  </body>
</html>