<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Concurrent::Agent
  
    &mdash; Concurrent
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!Concurrent/Agent.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (A)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../root/Concurrent.html" title="Concurrent (module)">Concurrent</a></span></span>
     &raquo; 
    <span class="title">Agent</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Concurrent::Agent
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Concurrent::Agent</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2"><span class='object_link'><a href="Concern/Dereferenceable.html" title="Concurrent::Concern::Dereferenceable (module)">Concern::Dereferenceable</a></span>, <span class='object_link'><a href="Concern/Observable.html" title="Concurrent::Concern::Observable (module)">Concern::Observable</a></span></dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">lib/concurrent/agent.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p><strong>Edge Feature:</strong> Edge features are under active development and may change frequently. They are expected not to
keep backward compatibility (there may also lack tests and documentation). Semantic versions will
be obeyed though. Features developed in <code>concurrent-ruby-edge</code> are expected to move
to <code>concurrent-ruby</code> when final.</p>
</div>
  </div>

<p><code>Agent</code>s are inspired by <a href="http://clojure.org/">Clojure&#39;s</a> <a href="http://clojure.org/agents">agent</a> function. An <code>Agent</code> is a single atomic value that represents an identity. The current value of the <code>Agent</code> can be requested at any time (<code>deref</code>). Each <code>Agent</code> has a work queue and operates on the global thread pool (see below). Consumers can <code>post</code> code blocks to the <code>Agent</code>. The code block (function) will receive the current value of the <code>Agent</code> as its sole parameter. The return value of the block will become the new value of the <code>Agent</code>. <code>Agent</code>s support two error handling modes: fail and continue. A good example of an <code>Agent</code> is a shared incrementing counter, such as the score in a video game. </p>

<p>An <code>Agent</code> must be initialize with an initial value. This value is always accessible via the <code>value</code> (or <code>deref</code>) methods. Code blocks sent to the <code>Agent</code> will be processed in the order received. As each block is processed the current value is updated with the result from the block. This update is an atomic operation so a <code>deref</code> will never block and will always return the current value. </p>

<p>When an <code>Agent</code> is created it may be given an optional <code>validate</code> block and zero or more <code>rescue</code> blocks. When a new value is calculated the value will be checked against the validator, if present. If the validator returns <code>true</code> the new value will be accepted. If it returns <code>false</code> it will be rejected. If a block raises an exception during execution the list of <code>rescue</code> blocks will be seacrhed in order until one matching the current exception is found. That <code>rescue</code> block will then be called an passed the exception object. If no matching <code>rescue</code> block is found, or none were configured, then the exception will be suppressed. </p>

<p><code>Agent</code>s also implement Ruby&#39;s <a href="http://ruby-doc.org/stdlib-2.0/libdoc/observer/rdoc/Observable.html">Observable</a>. Code that observes an <code>Agent</code> will receive a callback with the new value any time the value is changed. </p>

<h2>Copy Options</h2>

<p>Object references in Ruby are mutable. This can lead to serious
problems when the <span class='object_link'><a href="Concern/Dereferenceable.html#value-instance_method" title="Concurrent::Concern::Dereferenceable#value (method)">Concern::Dereferenceable#value</a></span> of an object is a mutable reference. Which
is always the case unless the value is a <code>Fixnum</code>, <code>Symbol</code>, or similar
&quot;primative&quot; data type. Each instance can be configured with a few
options that can help protect the program from potentially dangerous
operations. Each of these options can be optionally set when the oject
instance is created:</p>

<ul>
<li><code>:dup_on_deref</code> When true the object will call the <code>#dup</code> method on
the <code>value</code> object every time the <code>#value</code> methid is called
(default: false)</li>
<li><code>:freeze_on_deref</code> When true the object will call the <code>#freeze</code>
method on the <code>value</code> object every time the <code>#value</code> method is called
(default: false)</li>
<li><code>:copy_on_deref</code> When given a <code>Proc</code> object the <code>Proc</code> will be run
every time   the <code>#value</code> method is called. The <code>Proc</code> will be given
the current <code>value</code> as its only argument and the result returned by
the block will be the return   value of the <code>#value</code> call. When <code>nil</code>
this option will be ignored (default: nil)</li>
</ul>

<p>When multiple deref options are set the order of operations is strictly defined.
The order of deref operations is:</p>

<ul>
<li><code>:copy_on_deref</code></li>
<li><code>:dup_on_deref</code></li>
<li><code>:freeze_on_deref</code></li>
</ul>

<p>Because of this ordering there is no need to <code>#freeze</code> an object created by a
provided <code>:copy_on_deref</code> block. Simply set <code>:freeze_on_deref</code> to <code>true</code>.
Setting both <code>:dup_on_deref</code> to <code>true</code> and <code>:freeze_on_deref</code> to <code>true</code> is
as close to the behavior of a &quot;pure&quot; functional language (like Erlang, Clojure,
or Haskell) as we are likely to get in Ruby.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>Simple Example</p>
</div></p>
      
      <pre class="example code"><code>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>concurrent</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_score'>score</span> <span class='op'>=</span> <span class='const'>Concurrent</span><span class='op'>::</span><span class='const'>Agent</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>10</span><span class='rparen'>)</span>
<span class='id identifier rubyid_score'>score</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='comment'>#=&gt; 10
</span>
<span class='id identifier rubyid_score'>score</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_proc'>proc</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_current'>current</span><span class='op'>|</span> <span class='id identifier rubyid_current'>current</span> <span class='op'>+</span> <span class='int'>100</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='float'>0.1</span><span class='rparen'>)</span>
<span class='id identifier rubyid_score'>score</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='comment'>#=&gt; 110
</span>
<span class='id identifier rubyid_score'>score</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_proc'>proc</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_current'>current</span><span class='op'>|</span> <span class='id identifier rubyid_current'>current</span> <span class='op'>*</span> <span class='int'>2</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='float'>0.1</span><span class='rparen'>)</span>
<span class='id identifier rubyid_score'>score</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='comment'>#=&gt; 220
</span>
<span class='id identifier rubyid_score'>score</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_proc'>proc</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_current'>current</span><span class='op'>|</span> <span class='id identifier rubyid_current'>current</span> <span class='op'>-</span> <span class='int'>50</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='float'>0.1</span><span class='rparen'>)</span>
<span class='id identifier rubyid_score'>score</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='comment'>#=&gt; 170</span></code></pre>
    
      
        <p class="example_title"><div class='inline'><p>With Validation and Error Handling</p>
</div></p>
      
      <pre class="example code"><code>
<span class='id identifier rubyid_score'>score</span> <span class='op'>=</span> <span class='const'>Concurrent</span><span class='op'>::</span><span class='const'>Agent</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_validate'>validate</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_value'>value</span><span class='op'>|</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>&lt;=</span> <span class='int'>1024</span> <span class='rbrace'>}</span><span class='period'>.</span>
          <span class='id identifier rubyid_rescue'>rescue</span><span class='lparen'>(</span><span class='const'>NoMethodError</span><span class='rparen'>)</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_ex'>ex</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Bam!</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span><span class='period'>.</span>
          <span class='id identifier rubyid_rescue'>rescue</span><span class='lparen'>(</span><span class='const'>ArgumentError</span><span class='rparen'>)</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_ex'>ex</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Pow!</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span><span class='period'>.</span>
          <span class='id identifier rubyid_rescue'>rescue</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_ex'>ex</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Boom!</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_score'>score</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='comment'>#=&gt; 0
</span>
<span class='id identifier rubyid_score'>score</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_proc'>proc</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_current'>current</span><span class='op'>|</span> <span class='id identifier rubyid_current'>current</span> <span class='op'>+</span> <span class='int'>2048</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='float'>0.1</span><span class='rparen'>)</span>
<span class='id identifier rubyid_score'>score</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='comment'>#=&gt; 0
</span>
<span class='id identifier rubyid_score'>score</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_proc'>proc</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_current'>current</span><span class='op'>|</span> <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='float'>0.1</span><span class='rparen'>)</span>
<span class='comment'>#=&gt; puts &quot;Pow!&quot;
</span><span class='id identifier rubyid_score'>score</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='comment'>#=&gt; 0
</span>
<span class='id identifier rubyid_score'>score</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_proc'>proc</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_current'>current</span><span class='op'>|</span> <span class='id identifier rubyid_current'>current</span> <span class='op'>+</span> <span class='int'>100</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='float'>0.1</span><span class='rparen'>)</span>
<span class='id identifier rubyid_score'>score</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='comment'>#=&gt; 100</span></code></pre>
    
      
        <p class="example_title"><div class='inline'><p>With Observation</p>
</div></p>
      
      <pre class="example code"><code>
<span class='id identifier rubyid_bingo'>bingo</span> <span class='op'>=</span> <span class='const'>Class</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lbrace'>{</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_time'>time</span><span class='comma'>,</span> <span class='id identifier rubyid_score'>score</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Bingo! [score: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_score'>score</span><span class='embexpr_end'>}</span><span class='tstring_content'>, time: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_time'>time</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_score'>score</span> <span class='op'>&gt;=</span> <span class='int'>100</span>
  <span class='kw'>end</span>
<span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>

<span class='id identifier rubyid_score'>score</span> <span class='op'>=</span> <span class='const'>Concurrent</span><span class='op'>::</span><span class='const'>Agent</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>
<span class='id identifier rubyid_score'>score</span><span class='period'>.</span><span class='id identifier rubyid_add_observer'>add_observer</span><span class='lparen'>(</span><span class='id identifier rubyid_bingo'>bingo</span><span class='rparen'>)</span>

<span class='id identifier rubyid_score'>score</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_proc'>proc</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_current'>current</span><span class='op'>|</span> <span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='float'>0.1</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='id identifier rubyid_current'>current</span> <span class='op'>+=</span> <span class='int'>30</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_score'>score</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_proc'>proc</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_current'>current</span><span class='op'>|</span> <span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='float'>0.1</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='id identifier rubyid_current'>current</span> <span class='op'>+=</span> <span class='int'>30</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_score'>score</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_proc'>proc</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_current'>current</span><span class='op'>|</span> <span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='float'>0.1</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='id identifier rubyid_current'>current</span> <span class='op'>+=</span> <span class='int'>30</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_score'>score</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_proc'>proc</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_current'>current</span><span class='op'>|</span> <span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='float'>0.1</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='id identifier rubyid_current'>current</span> <span class='op'>+=</span> <span class='int'>30</span> <span class='rbrace'>}</span>

<span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span>
<span class='comment'>#=&gt; Bingo! [score: 120, time: 2013-07-22 21:26:08 -0400]</span></code></pre>
    
  </div>


</div>



  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#fast_executor-instance_method" title="#fast_executor (instance method)">- (Object) <strong>fast_executor</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#io_executor-instance_method" title="#io_executor (instance method)">- (Object) <strong>io_executor</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#timeout-instance_method" title="#timeout (instance method)">- (Fixnum) <strong>timeout</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The maximum number of seconds before an update is cancelled.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#%3C%3C-instance_method" title="#&lt;&lt; (instance method)">- (Object) <strong>&lt;&lt;</strong>(block) {|value| ... }</a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Update the current value with the result of the given block fast, block should not do blocking calls, use #post_off for blocking calls.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_observer-instance_method" title="#add_observer (instance method)">- (Object) <strong>add_observer</strong>(*args, &amp;block) </a>
    

    
  </span>
  
    <span class="note title not_defined_here">
      included
      from <span class='object_link'><a href="Concern/Observable.html#add_observer-instance_method" title="Concurrent::Concern::Observable#add_observer (method)">Concern::Observable</a></span>
    </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The added observer.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#await-instance_method" title="#await (instance method)">- (Boolean) <strong>await</strong>(timeout = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Waits/blocks until all the updates sent before this call are done.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#count_observers-instance_method" title="#count_observers (instance method)">- (Integer) <strong>count_observers</strong> </a>
    

    
  </span>
  
    <span class="note title not_defined_here">
      included
      from <span class='object_link'><a href="Concern/Observable.html#count_observers-instance_method" title="Concurrent::Concern::Observable#count_observers (method)">Concern::Observable</a></span>
    </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The observers count.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#delete_observer-instance_method" title="#delete_observer (instance method)">- (Object) <strong>delete_observer</strong>(*args) </a>
    

    
  </span>
  
    <span class="note title not_defined_here">
      included
      from <span class='object_link'><a href="Concern/Observable.html#delete_observer-instance_method" title="Concurrent::Concern::Observable#delete_observer (method)">Concern::Observable</a></span>
    </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The deleted observer.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#delete_observers-instance_method" title="#delete_observers (instance method)">- (Observable) <strong>delete_observers</strong> </a>
    

    
  </span>
  
    <span class="note title not_defined_here">
      included
      from <span class='object_link'><a href="Concern/Observable.html#delete_observers-instance_method" title="Concurrent::Concern::Observable#delete_observers (method)">Concern::Observable</a></span>
    </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Self.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#deprecated-instance_method" title="#deprecated (instance method)">- (Object) <strong>deprecated</strong>(message, strip = 2) </a>
    

    
  </span>
  
    <span class="note title not_defined_here">
      included
      from <span class='object_link'><a href="Concern/Deprecation.html#deprecated-instance_method" title="Concurrent::Concern::Deprecation#deprecated (method)">Concern::Deprecation</a></span>
    </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#deprecated_method-instance_method" title="#deprecated_method (instance method)">- (Object) <strong>deprecated_method</strong>(old_name, new_name) </a>
    

    
  </span>
  
    <span class="note title not_defined_here">
      included
      from <span class='object_link'><a href="Concern/Deprecation.html#deprecated_method-instance_method" title="Concurrent::Concern::Deprecation#deprecated_method (method)">Concern::Deprecation</a></span>
    </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Agent) <strong>initialize</strong>(initial, opts = {}) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Initialize a new Agent with the given initial value and provided options.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#log-instance_method" title="#log (instance method)">- (Object) <strong>log</strong>(level, progname, message = nil, &amp;block) </a>
    

    
  </span>
  
    <span class="note title not_defined_here">
      included
      from <span class='object_link'><a href="Concern/Logging.html#log-instance_method" title="Concurrent::Concern::Logging#log (method)">Concern::Logging</a></span>
    </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Logs through <span class='object_link'><a href="Configuration.html#logger-instance_method" title="Concurrent::Configuration#logger (method)">Configuration#logger</a></span>, it can be overridden by setting @logger.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#post-instance_method" title="#post (instance method)">- (true<sup>?</sup>) <strong>post</strong> {|value| ... }</a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Update the current value with the result of the given block fast, block should not do blocking calls, use #post_off for blocking calls.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#post_off-instance_method" title="#post_off (instance method)">- (true<sup>?</sup>) <strong>post_off</strong>(timeout = nil) {|value| ... }</a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Update the current value with the result of the given block fast, block can do blocking calls.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#rescue-instance_method" title="#rescue (instance method)">- (Object) <strong>rescue</strong>(clazz = StandardError) {|ex| ... }</a>
    

    
      (also: #catch, #on_error)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Specifies a block fast to be performed when an update fast raises an exception.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#validate-instance_method" title="#validate (instance method)">- (Object) <strong>validate</strong> {|value| ... }</a>
    

    
      (also: #validates, #validate_with, #validates_with)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>A block fast to be performed after every update to validate if the new value is valid.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#value-instance_method" title="#value (instance method)">- (Object) <strong>value</strong> </a>
    

    
      (also: #deref)
    
  </span>
  
    <span class="note title not_defined_here">
      included
      from <span class='object_link'><a href="Concern/Dereferenceable.html#value-instance_method" title="Concurrent::Concern::Dereferenceable#value (method)">Concern::Dereferenceable</a></span>
    </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Return the value this object represents after applying the options specified by the <code>#set_deref_options</code> method.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#with_observer-instance_method" title="#with_observer (instance method)">- (Observable) <strong>with_observer</strong>(*args, &amp;block) </a>
    

    
  </span>
  
    <span class="note title not_defined_here">
      included
      from <span class='object_link'><a href="Concern/Observable.html#with_observer-instance_method" title="Concurrent::Concern::Observable#with_observer (method)">Concern::Observable</a></span>
    </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>as #add_observer but it can be used for chaining.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Concurrent::Agent (class)">Agent</a></span></tt>) <strong>initialize</strong>(initial, opts = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Initialize a new Agent with the given initial value and provided options.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>initial</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the initial value</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>the options used to define the behavior at update and deref
and to specify the executor on which to perform actions</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>opts</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:executor</span>
          <span class="type">(<tt><span class='object_link'>Executor</span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>when set use the given <code>Executor</code> instance.
Three special values are also supported: <code>:task</code> returns the global task pool,
<code>:operation</code> returns the global operation pool, and <code>:immediate</code> returns a new
<code>ImmediateExecutor</code> object.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:dup_on_deref</span>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>Call <code>#dup</code> before
returning the data from <span class='object_link'><a href="Concern/Dereferenceable.html#value-instance_method" title="Concurrent::Concern::Dereferenceable#value (method)">Concern::Dereferenceable#value</a></span></p>
</div>
          
        </li>
      
        <li>
          <span class="name">:freeze_on_deref</span>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>Call <code>#freeze</code> before
returning the data from <span class='object_link'><a href="Concern/Dereferenceable.html#value-instance_method" title="Concurrent::Concern::Dereferenceable#value (method)">Concern::Dereferenceable#value</a></span></p>
</div>
          
        </li>
      
        <li>
          <span class="name">:copy_on_deref</span>
          <span class="type">(<tt>Proc</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>nil</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>When calling the <span class='object_link'><a href="Concern/Dereferenceable.html#value-instance_method" title="Concurrent::Concern::Dereferenceable#value (method)">Concern::Dereferenceable#value</a></span>
method, call the given proc passing the internal value as the sole
argument then return the new value returned from the proc.</p>
</div>
          
        </li>
      
    </ul>
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


97
98
99
100
101
102
103
104
105
106
107</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/concurrent/agent.rb', line 97</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_initial'>initial</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='ivar'>@value</span>                <span class='op'>=</span> <span class='id identifier rubyid_initial'>initial</span>
  <span class='ivar'>@rescuers</span>             <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='ivar'>@validator</span>            <span class='op'>=</span> <span class='const'>Proc</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_result'>result</span><span class='op'>|</span> <span class='kw'>true</span> <span class='rbrace'>}</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_observers'>observers</span>        <span class='op'>=</span> <span class='const'>Collection</span><span class='op'>::</span><span class='const'>CopyOnWriteObserverSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@serialized_execution</span> <span class='op'>=</span> <span class='const'>SerializedExecution</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@io_executor</span>          <span class='op'>=</span> <span class='const'>Executor</span><span class='period'>.</span><span class='id identifier rubyid_executor_from_options'>executor_from_options</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='const'>Concurrent</span><span class='period'>.</span><span class='id identifier rubyid_global_io_executor'>global_io_executor</span>
  <span class='ivar'>@fast_executor</span>        <span class='op'>=</span> <span class='const'>Executor</span><span class='period'>.</span><span class='id identifier rubyid_executor_from_options'>executor_from_options</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='const'>Concurrent</span><span class='period'>.</span><span class='id identifier rubyid_global_fast_executor'>global_fast_executor</span>
  <span class='id identifier rubyid_init_mutex'>init_mutex</span>
  <span class='id identifier rubyid_set_deref_options'>set_deref_options</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="fast_executor-instance_method">
  
    - (<tt>Object</tt>) <strong>fast_executor</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


90
91
92</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/concurrent/agent.rb', line 90</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fast_executor'>fast_executor</span>
  <span class='ivar'>@fast_executor</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="io_executor-instance_method">
  
    - (<tt>Object</tt>) <strong>io_executor</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


90
91
92</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/concurrent/agent.rb', line 90</span>

<span class='kw'>def</span> <span class='id identifier rubyid_io_executor'>io_executor</span>
  <span class='ivar'>@io_executor</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="timeout-instance_method">
  
    - (<tt>Fixnum</tt>) <strong>timeout</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the maximum number of seconds before an update is cancelled</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the maximum number of seconds before an update is cancelled</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/concurrent/agent.rb', line 84</span>

<span class='kw'>class</span> <span class='const'>Agent</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Concern</span><span class='op'>::</span><span class='const'>Dereferenceable</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Concern</span><span class='op'>::</span><span class='const'>Observable</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Concern</span><span class='op'>::</span><span class='const'>Logging</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Concern</span><span class='op'>::</span><span class='const'>Deprecation</span>

  <span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbol'>:timeout</span><span class='comma'>,</span> <span class='symbol'>:io_executor</span><span class='comma'>,</span> <span class='symbol'>:fast_executor</span>

  <span class='comment'># Initialize a new Agent with the given initial value and provided options.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Object] initial the initial value
</span>  <span class='comment'>#
</span>  <span class='comment'># @!macro executor_and_deref_options
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_initial'>initial</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='ivar'>@value</span>                <span class='op'>=</span> <span class='id identifier rubyid_initial'>initial</span>
    <span class='ivar'>@rescuers</span>             <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='ivar'>@validator</span>            <span class='op'>=</span> <span class='const'>Proc</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_result'>result</span><span class='op'>|</span> <span class='kw'>true</span> <span class='rbrace'>}</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_observers'>observers</span>        <span class='op'>=</span> <span class='const'>Collection</span><span class='op'>::</span><span class='const'>CopyOnWriteObserverSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='ivar'>@serialized_execution</span> <span class='op'>=</span> <span class='const'>SerializedExecution</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='ivar'>@io_executor</span>          <span class='op'>=</span> <span class='const'>Executor</span><span class='period'>.</span><span class='id identifier rubyid_executor_from_options'>executor_from_options</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='const'>Concurrent</span><span class='period'>.</span><span class='id identifier rubyid_global_io_executor'>global_io_executor</span>
    <span class='ivar'>@fast_executor</span>        <span class='op'>=</span> <span class='const'>Executor</span><span class='period'>.</span><span class='id identifier rubyid_executor_from_options'>executor_from_options</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='const'>Concurrent</span><span class='period'>.</span><span class='id identifier rubyid_global_fast_executor'>global_fast_executor</span>
    <span class='id identifier rubyid_init_mutex'>init_mutex</span>
    <span class='id identifier rubyid_set_deref_options'>set_deref_options</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Specifies a block fast to be performed when an update fast raises
</span>  <span class='comment'># an exception. Rescue blocks will be checked in order they were added. The first
</span>  <span class='comment'># block for which the raised exception &quot;is-a&quot; subclass of the given `clazz` will
</span>  <span class='comment'># be called. If no `clazz` is given the block will match any caught exception.
</span>  <span class='comment'># This behavior is intended to be identical to Ruby&#39;s `begin/rescue/end` behavior.
</span>  <span class='comment'># Any number of rescue handlers can be added. If no rescue handlers are added then
</span>  <span class='comment'># caught exceptions will be suppressed.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Exception] clazz the class of exception to catch
</span>  <span class='comment'># @yield the block to be called when a matching exception is caught
</span>  <span class='comment'># @yieldparam [StandardError] ex the caught exception
</span>  <span class='comment'>#
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   score = Concurrent::Agent.new(0).
</span>  <span class='comment'>#             rescue(NoMethodError){|ex| puts &quot;Bam!&quot; }.
</span>  <span class='comment'>#             rescue(ArgumentError){|ex| puts &quot;Pow!&quot; }.
</span>  <span class='comment'>#             rescue{|ex| puts &quot;Boom!&quot; }
</span>  <span class='comment'>#
</span>  <span class='comment'>#   score &lt;&lt; proc{|current| raise ArgumentError }
</span>  <span class='comment'>#   sleep(0.1)
</span>  <span class='comment'>#   #=&gt; puts &quot;Pow!&quot;
</span>  <span class='kw'>def</span> <span class='kw'>rescue</span><span class='lparen'>(</span><span class='id identifier rubyid_clazz'>clazz</span> <span class='op'>=</span> <span class='const'>StandardError</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_mutex'>mutex</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
        <span class='ivar'>@rescuers</span> <span class='op'>&lt;&lt;</span> <span class='const'>Rescuer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_clazz'>clazz</span><span class='comma'>,</span> <span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_alias_method'>alias_method</span> <span class='symbol'>:catch</span><span class='comma'>,</span> <span class='symbol'>:rescue</span>
  <span class='id identifier rubyid_alias_method'>alias_method</span> <span class='symbol'>:on_error</span><span class='comma'>,</span> <span class='symbol'>:rescue</span>

  <span class='comment'># A block fast to be performed after every update to validate if the new
</span>  <span class='comment'># value is valid. If the new value is not valid then the current value is not
</span>  <span class='comment'># updated. If no validator is provided then all updates are considered valid.
</span>  <span class='comment'>#
</span>  <span class='comment'># @yield the block to be called after every update fast to determine if
</span>  <span class='comment'>#   the result is valid
</span>  <span class='comment'># @yieldparam [Object] value the result of the last update fast
</span>  <span class='comment'># @yieldreturn [Boolean] true if the value is valid else false
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_validate'>validate</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>

    <span class='kw'>unless</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_mutex'>mutex</span><span class='period'>.</span><span class='id identifier rubyid_lock'>lock</span>
        <span class='ivar'>@validator</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span>
      <span class='kw'>ensure</span>
        <span class='id identifier rubyid_mutex'>mutex</span><span class='period'>.</span><span class='id identifier rubyid_unlock'>unlock</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_alias_method'>alias_method</span> <span class='symbol'>:validates</span><span class='comma'>,</span> <span class='symbol'>:validate</span>
  <span class='id identifier rubyid_alias_method'>alias_method</span> <span class='symbol'>:validate_with</span><span class='comma'>,</span> <span class='symbol'>:validate</span>
  <span class='id identifier rubyid_alias_method'>alias_method</span> <span class='symbol'>:validates_with</span><span class='comma'>,</span> <span class='symbol'>:validate</span>

  <span class='comment'># Update the current value with the result of the given block fast,
</span>  <span class='comment'># block should not do blocking calls, use #post_off for blocking calls
</span>  <span class='comment'>#
</span>  <span class='comment'># @yield the fast to be performed with the current value in order to calculate
</span>  <span class='comment'>#   the new value
</span>  <span class='comment'># @yieldparam [Object] value the current value
</span>  <span class='comment'># @yieldreturn [Object] the new value
</span>  <span class='comment'># @return [true, nil] nil when no block is given
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_post'>post</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_post_on'>post_on</span><span class='lparen'>(</span><span class='ivar'>@fast_executor</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Update the current value with the result of the given block fast,
</span>  <span class='comment'># block can do blocking calls
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Fixnum, nil] timeout [DEPRECATED] maximum number of seconds before an update is cancelled
</span>  <span class='comment'>#
</span>  <span class='comment'># @yield the fast to be performed with the current value in order to calculate
</span>  <span class='comment'>#   the new value
</span>  <span class='comment'># @yieldparam [Object] value the current value
</span>  <span class='comment'># @yieldreturn [Object] the new value
</span>  <span class='comment'># @return [true, nil] nil when no block is given
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_post_off'>post_off</span><span class='lparen'>(</span><span class='id identifier rubyid_timeout'>timeout</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_task'>task</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_timeout'>timeout</span>
             <span class='id identifier rubyid_deprecated'>deprecated</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>post_off with option timeout options is deprecated and will be removed</span><span class='tstring_end'>&#39;</span></span>
             <span class='id identifier rubyid_lambda'>lambda</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
               <span class='id identifier rubyid_future'>future</span> <span class='op'>=</span> <span class='const'>Future</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span> <span class='kw'>do</span>
                 <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
               <span class='kw'>end</span>
               <span class='kw'>if</span> <span class='id identifier rubyid_future'>future</span><span class='period'>.</span><span class='id identifier rubyid_wait'>wait</span><span class='lparen'>(</span><span class='id identifier rubyid_timeout'>timeout</span><span class='rparen'>)</span>
                 <span class='id identifier rubyid_future'>future</span><span class='period'>.</span><span class='id identifier rubyid_value!'>value!</span>
               <span class='kw'>else</span>
                 <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Concurrent</span><span class='op'>::</span><span class='const'>TimeoutError</span>
               <span class='kw'>end</span>
             <span class='kw'>end</span>
           <span class='kw'>else</span>
             <span class='id identifier rubyid_block'>block</span>
           <span class='kw'>end</span>
    <span class='id identifier rubyid_post_on'>post_on</span><span class='lparen'>(</span><span class='ivar'>@io_executor</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_task'>task</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Update the current value with the result of the given block fast,
</span>  <span class='comment'># block should not do blocking calls, use #post_off for blocking calls
</span>  <span class='comment'>#
</span>  <span class='comment'># @yield the fast to be performed with the current value in order to calculate
</span>  <span class='comment'>#   the new value
</span>  <span class='comment'># @yieldparam [Object] value the current value
</span>  <span class='comment'># @yieldreturn [Object] the new value
</span>  <span class='kw'>def</span> <span class='op'>&lt;&lt;</span><span class='lparen'>(</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_post'>post</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='comment'># Waits/blocks until all the updates sent before this call are done.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Numeric] timeout the maximum time in second to wait.
</span>  <span class='comment'># @return [Boolean] false on timeout, true otherwise
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_await'>await</span><span class='lparen'>(</span><span class='id identifier rubyid_timeout'>timeout</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_done'>done</span> <span class='op'>=</span> <span class='const'>Event</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_post'>post</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_val'>val</span><span class='op'>|</span> <span class='id identifier rubyid_done'>done</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='semicolon'>;</span> <span class='id identifier rubyid_val'>val</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_done'>done</span><span class='period'>.</span><span class='id identifier rubyid_wait'>wait</span> <span class='id identifier rubyid_timeout'>timeout</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_private'>private</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_post_on'>post_on</span><span class='lparen'>(</span><span class='id identifier rubyid_executor'>executor</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='ivar'>@serialized_execution</span><span class='period'>.</span><span class='id identifier rubyid_post'>post</span><span class='lparen'>(</span><span class='id identifier rubyid_executor'>executor</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_work'>work</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
    <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='comment'># @!visibility private
</span>  <span class='const'>Rescuer</span> <span class='op'>=</span> <span class='const'>Struct</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:clazz</span><span class='comma'>,</span> <span class='symbol'>:block</span><span class='rparen'>)</span> <span class='comment'># :nodoc:
</span>
  <span class='comment'># @!visibility private
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_try_rescue'>try_rescue</span><span class='lparen'>(</span><span class='id identifier rubyid_ex'>ex</span><span class='rparen'>)</span> <span class='comment'># :nodoc:
</span>    <span class='id identifier rubyid_rescuer'>rescuer</span> <span class='op'>=</span> <span class='id identifier rubyid_mutex'>mutex</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
      <span class='ivar'>@rescuers</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span> <span class='id identifier rubyid_ex'>ex</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_clazz'>clazz</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_rescuer'>rescuer</span><span class='period'>.</span><span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_ex'>ex</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_rescuer'>rescuer</span>
  <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ex'>ex</span>
    <span class='comment'># suppress
</span>    <span class='id identifier rubyid_log'>log</span> <span class='const'>DEBUG</span><span class='comma'>,</span> <span class='id identifier rubyid_ex'>ex</span>
  <span class='kw'>end</span>

  <span class='comment'># @!visibility private
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_work'>work</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_handler'>handler</span><span class='rparen'>)</span> <span class='comment'># :nodoc:
</span>    <span class='id identifier rubyid_validator'>validator</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_mutex'>mutex</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='lbrace'>{</span> <span class='lbracket'>[</span><span class='ivar'>@validator</span><span class='comma'>,</span> <span class='ivar'>@value</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>

    <span class='kw'>begin</span>
      <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_handler'>handler</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_valid'>valid</span>  <span class='op'>=</span> <span class='id identifier rubyid_validator'>validator</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ex'>ex</span>
      <span class='id identifier rubyid_exception'>exception</span> <span class='op'>=</span> <span class='id identifier rubyid_ex'>ex</span>
    <span class='kw'>end</span>

    <span class='kw'>begin</span>
      <span class='id identifier rubyid_mutex'>mutex</span><span class='period'>.</span><span class='id identifier rubyid_lock'>lock</span>
      <span class='id identifier rubyid_should_notify'>should_notify</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_exception'>exception</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_valid'>valid</span>
                        <span class='ivar'>@value</span> <span class='op'>=</span> <span class='id identifier rubyid_result'>result</span>
                        <span class='kw'>true</span>
                      <span class='kw'>end</span>
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_mutex'>mutex</span><span class='period'>.</span><span class='id identifier rubyid_unlock'>unlock</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_should_notify'>should_notify</span>
      <span class='id identifier rubyid_time'>time</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
      <span class='id identifier rubyid_observers'>observers</span><span class='period'>.</span><span class='id identifier rubyid_notify_observers'>notify_observers</span> <span class='lbrace'>{</span> <span class='lbracket'>[</span><span class='id identifier rubyid_time'>time</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_try_rescue'>try_rescue</span><span class='lparen'>(</span><span class='id identifier rubyid_exception'>exception</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="<<-instance_method">
  
    - (<tt>Object</tt>) <strong>&lt;&lt;</strong>(block) {|value| ... }
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Update the current value with the result of the given block fast,
block should not do blocking calls, use #post_off for blocking calls</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'><p>the fast to be performed with the current value in order to calculate
the new value</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the current value</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Returns:</p>
<ul class="yieldreturn">
  
    <li>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the new value</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


215
216
217
218</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/concurrent/agent.rb', line 215</span>

<span class='kw'>def</span> <span class='op'>&lt;&lt;</span><span class='lparen'>(</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_post'>post</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="add_observer-instance_method">
  
    - (<tt>Object</tt>) <strong>add_observer</strong>(*args, &amp;block) 
  

  

  
    <span class="not_defined_here">
      Originally defined in module
        <span class='object_link'><a href="Concern/Observable.html#add_observer-instance_method" title="Concurrent::Concern::Observable#add_observer (method)">Concern::Observable</a></span>
    </span>
  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the added observer</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the added observer</p>
</div>
      
    </li>
  
</ul>

</div>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="await-instance_method">
  
    - (<tt>Boolean</tt>) <strong>await</strong>(timeout = nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Waits/blocks until all the updates sent before this call are done.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>timeout</span>
      
      
        <span class='type'>(<tt>Numeric</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>the maximum time in second to wait.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>false on timeout, true otherwise</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


224
225
226
227
228</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/concurrent/agent.rb', line 224</span>

<span class='kw'>def</span> <span class='id identifier rubyid_await'>await</span><span class='lparen'>(</span><span class='id identifier rubyid_timeout'>timeout</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_done'>done</span> <span class='op'>=</span> <span class='const'>Event</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_post'>post</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_val'>val</span><span class='op'>|</span> <span class='id identifier rubyid_done'>done</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='semicolon'>;</span> <span class='id identifier rubyid_val'>val</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_done'>done</span><span class='period'>.</span><span class='id identifier rubyid_wait'>wait</span> <span class='id identifier rubyid_timeout'>timeout</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="count_observers-instance_method">
  
    - (<tt>Integer</tt>) <strong>count_observers</strong> 
  

  

  
    <span class="not_defined_here">
      Originally defined in module
        <span class='object_link'><a href="Concern/Observable.html#count_observers-instance_method" title="Concurrent::Concern::Observable#count_observers (method)">Concern::Observable</a></span>
    </span>
  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the observers count</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the observers count</p>
</div>
      
    </li>
  
</ul>

</div>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="delete_observer-instance_method">
  
    - (<tt>Object</tt>) <strong>delete_observer</strong>(*args) 
  

  

  
    <span class="not_defined_here">
      Originally defined in module
        <span class='object_link'><a href="Concern/Observable.html#delete_observer-instance_method" title="Concurrent::Concern::Observable#delete_observer (method)">Concern::Observable</a></span>
    </span>
  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the deleted observer</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the deleted observer</p>
</div>
      
    </li>
  
</ul>

</div>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="delete_observers-instance_method">
  
    - (<tt><span class='object_link'><a href="Concern/Observable.html" title="Concurrent::Concern::Observable (module)">Observable</a></span></tt>) <strong>delete_observers</strong> 
  

  

  
    <span class="not_defined_here">
      Originally defined in module
        <span class='object_link'><a href="Concern/Observable.html#delete_observers-instance_method" title="Concurrent::Concern::Observable#delete_observers (method)">Concern::Observable</a></span>
    </span>
  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns self</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Concern/Observable.html" title="Concurrent::Concern::Observable (module)">Observable</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>self</p>
</div>
      
    </li>
  
</ul>

</div>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="deprecated-instance_method">
  
    - (<tt>Object</tt>) <strong>deprecated</strong>(message, strip = 2) 
  

  

  
    <span class="not_defined_here">
      Originally defined in module
        <span class='object_link'><a href="Concern/Deprecation.html#deprecated-instance_method" title="Concurrent::Concern::Deprecation#deprecated (method)">Concern::Deprecation</a></span>
    </span>
  
</h3>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="deprecated_method-instance_method">
  
    - (<tt>Object</tt>) <strong>deprecated_method</strong>(old_name, new_name) 
  

  

  
    <span class="not_defined_here">
      Originally defined in module
        <span class='object_link'><a href="Concern/Deprecation.html#deprecated_method-instance_method" title="Concurrent::Concern::Deprecation#deprecated_method (method)">Concern::Deprecation</a></span>
    </span>
  
</h3>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="log-instance_method">
  
    - (<tt>Object</tt>) <strong>log</strong>(level, progname, message = nil, &amp;block) 
  

  

  
    <span class="not_defined_here">
      Originally defined in module
        <span class='object_link'><a href="Concern/Logging.html#log-instance_method" title="Concurrent::Concern::Logging#log (method)">Concern::Logging</a></span>
    </span>
  
</h3><div class="docstring">
  <div class="discussion">
    <p>Logs through <span class='object_link'><a href="Configuration.html#logger-instance_method" title="Concurrent::Configuration#logger (method)">Concurrent::Configuration#logger</a></span>, it can be overridden by setting @logger</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>level</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>one of Logger::Severity constants</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>progname</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>e.g. a path of an Actor</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>message</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>when nil block is used to generate the message</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Yield Returns:</p>
<ul class="yieldreturn">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>a message</p>
</div>
      
    </li>
  
</ul>

</div>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="post-instance_method">
  
    - (<tt>true</tt><sup>?</sup>) <strong>post</strong> {|value| ... }
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Update the current value with the result of the given block fast,
block should not do blocking calls, use #post_off for blocking calls</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'><p>the fast to be performed with the current value in order to calculate
the new value</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the current value</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Returns:</p>
<ul class="yieldreturn">
  
    <li>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the new value</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>nil when no block is given</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


175
176
177</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/concurrent/agent.rb', line 175</span>

<span class='kw'>def</span> <span class='id identifier rubyid_post'>post</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_post_on'>post_on</span><span class='lparen'>(</span><span class='ivar'>@fast_executor</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="post_off-instance_method">
  
    - (<tt>true</tt><sup>?</sup>) <strong>post_off</strong>(timeout = nil) {|value| ... }
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Update the current value with the result of the given block fast,
block can do blocking calls</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>timeout</span>
      
      
        <span class='type'>(<tt>Fixnum</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>[DEPRECATED] maximum number of seconds before an update is cancelled</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'><p>the fast to be performed with the current value in order to calculate
the new value</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the current value</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Returns:</p>
<ul class="yieldreturn">
  
    <li>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the new value</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>nil when no block is given</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/concurrent/agent.rb', line 189</span>

<span class='kw'>def</span> <span class='id identifier rubyid_post_off'>post_off</span><span class='lparen'>(</span><span class='id identifier rubyid_timeout'>timeout</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_task'>task</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_timeout'>timeout</span>
           <span class='id identifier rubyid_deprecated'>deprecated</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>post_off with option timeout options is deprecated and will be removed</span><span class='tstring_end'>&#39;</span></span>
           <span class='id identifier rubyid_lambda'>lambda</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
             <span class='id identifier rubyid_future'>future</span> <span class='op'>=</span> <span class='const'>Future</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span> <span class='kw'>do</span>
               <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
             <span class='kw'>end</span>
             <span class='kw'>if</span> <span class='id identifier rubyid_future'>future</span><span class='period'>.</span><span class='id identifier rubyid_wait'>wait</span><span class='lparen'>(</span><span class='id identifier rubyid_timeout'>timeout</span><span class='rparen'>)</span>
               <span class='id identifier rubyid_future'>future</span><span class='period'>.</span><span class='id identifier rubyid_value!'>value!</span>
             <span class='kw'>else</span>
               <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Concurrent</span><span class='op'>::</span><span class='const'>TimeoutError</span>
             <span class='kw'>end</span>
           <span class='kw'>end</span>
         <span class='kw'>else</span>
           <span class='id identifier rubyid_block'>block</span>
         <span class='kw'>end</span>
  <span class='id identifier rubyid_post_on'>post_on</span><span class='lparen'>(</span><span class='ivar'>@io_executor</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_task'>task</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="rescue-instance_method">
  
    - (<tt>Object</tt>) <strong>rescue</strong>(clazz = StandardError) {|ex| ... }
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='catch-instance_method'>catch</span>, <span id='on_error-instance_method'>on_error</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Specifies a block fast to be performed when an update fast raises
an exception. Rescue blocks will be checked in order they were added. The first
block for which the raised exception &quot;is-a&quot; subclass of the given <code>clazz</code> will
be called. If no <code>clazz</code> is given the block will match any caught exception.
This behavior is intended to be identical to Ruby&#39;s <code>begin/rescue/end</code> behavior.
Any number of rescue handlers can be added. If no rescue handlers are added then
caught exceptions will be suppressed.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_score'>score</span> <span class='op'>=</span> <span class='const'>Concurrent</span><span class='op'>::</span><span class='const'>Agent</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span><span class='period'>.</span>
          <span class='id identifier rubyid_rescue'>rescue</span><span class='lparen'>(</span><span class='const'>NoMethodError</span><span class='rparen'>)</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_ex'>ex</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Bam!</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span><span class='period'>.</span>
          <span class='id identifier rubyid_rescue'>rescue</span><span class='lparen'>(</span><span class='const'>ArgumentError</span><span class='rparen'>)</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_ex'>ex</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Pow!</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span><span class='period'>.</span>
          <span class='id identifier rubyid_rescue'>rescue</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_ex'>ex</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Boom!</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>

<span class='id identifier rubyid_score'>score</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_proc'>proc</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_current'>current</span><span class='op'>|</span> <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='float'>0.1</span><span class='rparen'>)</span>
<span class='comment'>#=&gt; puts &quot;Pow!&quot;</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>clazz</span>
      
      
        <span class='type'>(<tt>Exception</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>StandardError</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>the class of exception to catch</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'><p>the block to be called when a matching exception is caught</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>ex</span>
      
      
        <span class='type'>(<tt>StandardError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the caught exception</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


130
131
132
133
134
135
136
137</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/concurrent/agent.rb', line 130</span>

<span class='kw'>def</span> <span class='kw'>rescue</span><span class='lparen'>(</span><span class='id identifier rubyid_clazz'>clazz</span> <span class='op'>=</span> <span class='const'>StandardError</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_mutex'>mutex</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
      <span class='ivar'>@rescuers</span> <span class='op'>&lt;&lt;</span> <span class='const'>Rescuer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_clazz'>clazz</span><span class='comma'>,</span> <span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="validate-instance_method">
  
    - (<tt>Object</tt>) <strong>validate</strong> {|value| ... }
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='validates-instance_method'>validates</span>, <span id='validate_with-instance_method'>validate_with</span>, <span id='validates_with-instance_method'>validates_with</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>A block fast to be performed after every update to validate if the new
value is valid. If the new value is not valid then the current value is not
updated. If no validator is provided then all updates are considered valid.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'><p>the block to be called after every update fast to determine if
the result is valid</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the result of the last update fast</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Returns:</p>
<ul class="yieldreturn">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>true if the value is valid else false</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


150
151
152
153
154
155
156
157
158
159
160
161</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/concurrent/agent.rb', line 150</span>

<span class='kw'>def</span> <span class='id identifier rubyid_validate'>validate</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_mutex'>mutex</span><span class='period'>.</span><span class='id identifier rubyid_lock'>lock</span>
      <span class='ivar'>@validator</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span>
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_mutex'>mutex</span><span class='period'>.</span><span class='id identifier rubyid_unlock'>unlock</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="value-instance_method">
  
    - (<tt>Object</tt>) <strong>value</strong> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='deref-instance_method'>deref</span></span>
    </span>
  

  
    <span class="not_defined_here">
      Originally defined in module
        <span class='object_link'><a href="Concern/Dereferenceable.html#value-instance_method" title="Concurrent::Concern::Dereferenceable#value (method)">Concern::Dereferenceable</a></span>
    </span>
  
</h3><div class="docstring">
  <div class="discussion">
    <p>Return the value this object represents after applying the options specified
by the <code>#set_deref_options</code> method.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the current value of the object</p>
</div>
      
    </li>
  
</ul>

</div>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="with_observer-instance_method">
  
    - (<tt><span class='object_link'><a href="Concern/Observable.html" title="Concurrent::Concern::Observable (module)">Observable</a></span></tt>) <strong>with_observer</strong>(*args, &amp;block) 
  

  

  
    <span class="not_defined_here">
      Originally defined in module
        <span class='object_link'><a href="Concern/Observable.html#with_observer-instance_method" title="Concurrent::Concern::Observable#with_observer (method)">Concern::Observable</a></span>
    </span>
  
</h3><div class="docstring">
  <div class="discussion">
    <p>as #add_observer but it can be used for chaining</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Concern/Observable.html" title="Concurrent::Concern::Observable (module)">Observable</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>self</p>
</div>
      
    </li>
  
</ul>

</div>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Fri Jul 10 12:10:59 2015 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.2.1).
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-57940973-1', 'auto');
  ga('send', 'pageview');

</script>

  </body>
</html>